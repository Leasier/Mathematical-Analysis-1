# 第十六讲 函数的凹凸性与拐点

- 这里认为凸 convex 形如 $\lor$，凹 convene 形如 $\land$。

### 定义：凹凸性

对于 $f$ 定义域内的区间 $I$，若 $\forall x_1, x_2 \in I \land x_1 < x_2, \forall \gamma \in (0, 1), f(\gamma x_1 + (1 - \gamma) x_2) \leq \gamma f(x_1) + (1 - \gamma) f(x_2)$，则称 $f$ 在 $I$ 上为凸函数。将 $\leq$ 改为 $<$ 可得到严格凸函数的定义。

将 $\leq$ 改为 $\geq$、将 $<$ 改为 $>$ 可分别得到凹函数、严格凹函数的定义。

#### 定理（凸性的代数描述）

内容：$f$ 在 $I$ 上为凸函数 $\Leftrightarrow \forall x_1, x_2, x_3 \in I \land x_1 < x_2 < x_3, \Delta = \begin{vmatrix} 1 & x_1 & f(x_1) \\ 1 & x_2 & f(x_2) \\ 1 & x_3 & f(x_3) \end{vmatrix} \geq 0$。

- 将 $\geq$ 改为 $>$ 可得到严格凸函数的情况。

感性理解：

- 考虑行变换 $P_{1, 2}(-1), P_{1, 3}(-1)$，可得 $\Delta = \begin{vmatrix} 1 & x_1 & f(x_1) \\ 0 & x_2 - x_1 & f(x_2) - f(x_1) \\ 1 & x_3 - x_1 & f(x_3) - f(x_1) \end{vmatrix} = \begin{vmatrix} x_2 - x_1 & f(x_2) - f(x_1) \\ x_3 - x_1 & f(x_3) - f(x_1) \end{vmatrix}$。
- 在右手系中，令 $A(x_1, f(x_1), 0), B(x_2, f(x_2), 0), C(x_3, f(x_3), 0)$，则 $\Delta = ||\overrightarrow{AB} \times \overrightarrow{AC}||$。
- 当 $AB$ 不在 $AC$ “上面”，有 $\Delta \geq 0$；当 $AB$ 在 $AC$ “下面”，有 $\Delta > 0$。这与（严格）凸函数的定义完全一致。

证明：

- 令 $\gamma = \dfrac{x_3 - x_2}{x_3 - x_1}$，则 $x_2 = \gamma x_1 + (1 - \gamma) x_3$。
- 考虑行变换 $P_{1, 2}(-\gamma), P_{3, 2}(-(1 - \gamma))$，可得 $\Delta = \begin{vmatrix} 1 & x_1 & f(x_1) \\ 0 & 0 & f(x_2) - (\gamma f(x_1) + (1 - \gamma) f(x_3)) \\ 1 & x_3 & f(x_3) \end{vmatrix} = ((\gamma f(x_1) + (1 - \gamma) f(x_3)) - f(x_2)) (x_3 - x_1)$。
- 故 $\Delta \geq 0 \Leftrightarrow f(x_2) \leq \gamma f(x_1) + (1 - \gamma) f(x_3), \Delta > 0 \Leftrightarrow f(x_2) < \gamma f(x_1) + (1 - \gamma) f(x_3)$，遂得证。

#### 定理（凸性的几何描述）

内容：

$$
\begin{aligned}
& f 在 I 上为凸函数 \\
\Leftrightarrow &\forall x_1, x_2, x_3 \in I \land x_1 < x_2 < x_3, k_{AB} \leq k_{AC} \\
\Leftrightarrow &\forall x_1, x_2, x_3 \in I \land x_1 < x_2 < x_3, k_{AB} \leq k_{BC} \\
\Leftrightarrow &\forall x_1, x_2, x_3 \in I \land x_1 < x_2 < x_3, k_{AC} \leq k_{BC}
\end{aligned}
$$

- 其中 $A(x_1, f(x_1)), B(x_2, f(x_2)), C(x_3, f(x_3))$，后同。
- 将 $\leq$ 改为 $<$ 可得到严格凸函数的定义。

感性理解：割线斜率（严格）单调递增。

证明：行列式变换即可，略。

#### 推论（凸函数上四点间的割线斜率）

内容：若 $f$ 在 $I$ 上为凸函数，则 $\forall x_1, x_2, x_3, x_4 \in I \land x_1 < x_2 < x_3 < x_4$，有：

- (1) $k_{AB} \leq k_{AC} \leq k_{BC} \leq k_{BD} \leq k_{CD}$。
- (2) $k_{AB} \leq k_{AC} \leq k_{AD} \leq k_{BD} \leq k_{CD}$。
- 其中 $D(x_4, f(x_4))$。
- 将 $\leq$ 改为 $<$ 可得到严格凸函数的情况。
- **注意：$k_{BC}, k_{AD}$ 间没有明确的大小关系！**

证明：

- (1) 在凸性的几何描述中分别取 $(A, B, C), (B, C, D)$ 即得。
- (2) 在凸性的几何描述中分别取 $(A, B, C), (A, C, D), (A, B, D), (B, C, D)$ 即得。

### 凸性与导数

#### 定理（单侧导数存在）

内容：若 $f$ 是 $[a, b]$ 上的凸函数，则 $\forall x \in (a, b), f$ 在 $x$ 处左、右侧均可导。

- **注意：在内点处左、右侧均可导并不意味着在开区间上可导！例如 $f(x) = |x|$ 在 $[-1, 1]$ 上为凸函数，但在 $0 \in (-1, 1)$ 处不可导。**

证明：

- 下面只证右侧可导，左侧可导是同理的。
- $\forall x \in (a, b)$，在 $\check{U}^+(0, b - x)$ 上定义 $g(\Delta x) = \dfrac{f(x + \Delta x) - f(x)}{\Delta x}$。
- 由凸性的几何描述可知 $g$ 在定义域上**单调递增**，且有**下界**为 $\dfrac{f(x) - f(a)}{x - a}$。
- 故 $f'_+(x) = \displaystyle\lim_{\Delta x \to 0} g(\Delta x) = \inf_{\Delta x \to 0} g(\Delta x)$ 存在，即 $f$ 在 $x$ 处左侧可导。

#### 推论（开区间上连续）

内容：若 $f$ 是 $[a, b]$ 上的凸函数，则 $f$ 在 $(a, b)$ 上连续。

证明：

- $\forall x \in (a, b)$，由 $f$ 在 $x$ 处右侧可导与有限增量公式可知 $\displaystyle\lim_{\Delta x \to 0} (f(x + \Delta x) - f(x)) = \lim_{\Delta x \to 0} (f'_+(x) \Delta x + o(\Delta x)) = 0$。
- 故 $\displaystyle\lim_{\Delta x \to 0} f(x + \Delta x) = f(x)$，即 $f$ 在 $x$ 处右连续。
- 同理可得 $f$ 在 $x$ 处左连续，故 $f$ 在 $x$ 处连续。

#### 定理（单侧导数的大小关系）

内容：若 $f$ 是 $[a, b]$ 上的凸函数，则 $\forall a < x < y < b, f'_-(x) \leq f'_+(x) \leq f'_-(y) \leq f'_+(y)$。

- 结论也可以表述为：
- (1) $f'_-, f'_+$ 在 $(a, b)$ 上单调递增。
- (2) $\forall a < x < y < b, f'_+(x) \leq f'_-(y)$。

证明：

- 取 $a < x_- < x < x_+ \leq y_- < y < y_+ < b$，可知下面的不等式链：

$$
\frac{f(x_-) - f(x)}{x_- - x} \leq \frac{f(x_+) - f(x)}{x_+ - x} \leq \frac{f(y_-) - f(y)}{y_- - y} \leq \frac{f(y_+) - f(y)}{y_+ - y}
$$

- 同时取极限 $x_- \to x, x_+ \to x, y_- \to y, y_+ \to y$，可知 $f'_-(x) \leq f'_+(x) \leq f'_-(y) \leq f'_+(y)$。

#### 定理（单侧导数单侧连续）

内容：若 $f$ 是 $[a, b]$ 上的凸函数，则 $f'_-$ 在 $(a, b)$ 上左连续、$f'_+$ 在 $(a, b)$ 上右连续。

证明：

- **注意：下面可以取单侧极限的依据均为“单调性蕴含单侧极限存在”。**
- $\forall x \in (a, b)$，对不等式 $\forall y \in (x, b), f'_+(x) \leq f'_+(y)$ 取极限 $y \to x^+$，得 $f'_+(x) \leq f'_+(x^+) \ (1)$。
- 对不等式 $\forall x < y < z < b, f'_+(y) \leq \dfrac{f(z) - f(y)}{z - y}$ 取极限 $y \to x^+$，得 $f'_+(x^+) \leq \dfrac{f(z) - f(x)}{z - x}$，再取极限 $z \to x^+$，得 $f'_+(x^+) \leq f'_+(x) \ (2)$。
- 综合 (1)(2) 可知 $f'_+(x) = f'_+(x^+)$，即 $f'_+$ 在 $x$ 处右连续。
- 由 $x$ 的任意性，可知 $f'_+$ 在 $(a, b)$ 上右连续。
- 同理有 $f'_-$ 在 $(a, b)$ 上左连续。

------

通过有关 $f'_-, f'_+$ 的不等式及两个函数的单调性，我们直观感觉凸函数应该是“在大多数地方都可导”的，或者说至多是“由可数个连续可导函数拼起来”得到的，例如：

$$
f(x) = \begin{cases}
0, &\quad x = 0 \\
f(\dfrac{1}{2^k}) - (\dfrac{3}{2})^k (\dfrac{1}{2^k} - x), &\quad \dfrac{1}{2^{k + 1}} \leq x < \dfrac{1}{2^k}, k \in \mathbb{N} \\
2, &\quad x = 1
\end{cases}
$$

- $f$ 是 $[0, 1]$ 上的凸函数，且在 $(0, 1)$ 上的不可导点集为 $\{\dfrac{1}{2^k} \mid k \in \mathbb{N}_+\}$。

事实上这个感觉是正确的，下面是严格的叙述与证明。

#### 定理（可导点的稠密性）

内容：凸函数至多只有可数个不可导的点。

证明：

- 由 $f'_-$ 在 $x$ 处左连续，可知 $f'_-(x) = f'_-(x^-) \ (1)$。
- $\forall x \in (a, b)$，对不等式 $\forall y \in (a, x), f'_-(y) \leq f'_+(y) \leq f'_-(x)$ 取极限 $y \to x^-$，得 $f'_-(x^-) \leq f'_+(x^-) \leq f'_-(x) \ (2)$。
- 由 (1)(2) 可知 $f'_-(x) = f'_-(x^-) = f'_+(x^-) \ (3)$。
- **注意：(3) 和与之对偶的 $f'_+(x) = f'_+(x^+) = f'_-(x^+)$ 适用于任意凸函数！**
- 由于 $f'_+$ 单调，且根据单调函数的间断点至多只有可数个，可知 $f'_+$ 的间断点至多只有可数个。
- 而对于 $f'_+$ 的连续点 $x$，有 $f'_+(x) = f'_+(x^+) = f'_+(x^-) \ (4)$。
- 由 (3)(4) 可知 $f'_-(x) = f'_+(x)$，故 $f$ 在 $x$ 处可导。
- 综上，$f$ 的不可导点集与 $f'_+$ 的间断点集相同，故 $f$ 至多只有可数个不可导的点。

#### 定理（一阶导数条件）

条件：$f$ 在 $[a, b]$ 上连续，在 $(a, b)$ 上可导。

结论：$f$ 是 $[a, b]$ 上的（严格）凸函数 $\Leftrightarrow f'$ 在 $(a, b)$ 上（严格）单调递增。

证明（非严格的情况）：

- $\Leftarrow$：$\forall a \leq x_1 < x_2 < x_3 \leq b$，由 Lagrange 中值定理知：

$$
\begin{cases}
\exists \xi \in (x_1, x_2), \text{s.t. } k_{AB} = \dfrac{f(x_2) - f(x_1)}{x_2 - x_1} = f'(\xi) \\
\exists \eta \in (x_2, x_3), \text{s.t. } k_{BC} = \dfrac{f(x_2) - f(x_1)}{x_2 - x_1} = f'(\eta)
\end{cases}
$$

- 由 $f'$ 的单调性可知 $k_{AB} = f'(\xi) \leq f'(\eta) \leq k_{BC}$，故 $f$ 是 $[a, b]$ 上的凸函数。
- $\Rightarrow$：$\forall a < x_1 < x_2 < b$，令 $d = \dfrac{1}{2} (x_2 - x_1)$，则由凸性的几何描述的推论可知：

$$
\forall \Delta_1, \Delta_2 \in (0, d), \frac{f(x_1 + \Delta x_1) - f(x_1)}{\Delta x_1} \leq \frac{f(x_2) - f(x_1)}{x_2 - x_1} \leq \frac{f(x_2) - f(x_2 - \Delta_2)}{\Delta_2}
$$

- 令 $\Delta_1, \Delta_2 \to 0$，可知：

$$
f'(x_1) = f'_+(x_1) = \lim_{\Delta x_1 \to 0} \frac{f(x_1 + \Delta x_1) - f(x_1)}{\Delta x_1} \leq \frac{f(x_2) - f(x_1)}{x_2 - x_1} \leq \lim_{\Delta x_2 \to 0} \frac{f(x_2) - f(x_2 - \Delta_2)}{\Delta_2} = f'_-(x_2) = f'(x_2)
$$

- 故 $f'$ 在 $(a, b)$ 上单调递增。

而对于严格的情况，证明 $\Rightarrow$ 的部分时，为保持不等号的严格性，需要取一个中间值，即令 $m = \dfrac{1}{2} (x_1 + x_2)$，有：

$$
\forall \Delta_1, \Delta_2 \in (0, d), \frac{f(x_1 + \Delta x_1) - f(x_1)}{\Delta x_1} \leq \frac{f(m) - f(x_1)}{m - x_1} < \frac{f(x_2) - f(m)}{x_2 - m} \leq \frac{f(x_2) - f(x_2 - \Delta_2)}{\Delta_2}
$$

由此便可在结论中取得严格单调递增。

#### 定理（二阶导数条件）

条件：$f$ 在 $[a, b]$ 上连续，在 $(a, b)$ 上二阶可导。

结论：

- (1) $f$ 是 $[a, b]$ 上的凸函数 $\Leftrightarrow \forall x \in (a, b), f''(x) \geq 0$。
- (2) $f$ 是 $[a, b]$ 上的严格凸函数 $\Leftrightarrow \forall x \in (a, b), f''(x) \geq 0$ 且 $f''$ 不在 $(a, b)$ 的任意开区间上恒为 $0$。

证明：综合一阶导数条件和函数单调性的判据即可，略。

#### 定理（一阶展开条件）

条件：$f$ 在 $[a, b]$ 上连续，在 $(a, b)$ 上可导。

结论：

- (1) $f$ 是 $[a, b]$ 上的凸函数 $\Leftrightarrow \forall x_0 \in (a, b), \forall x \in [a, b], f(x) \geq f(x_0) + f'(x_0) (x - x_0)$。
- (2) $f$ 是 $[a, b]$ 上的严格凸函数 $\Leftrightarrow \forall x_0 \in (a, b), \forall x \in [a, b] \backslash \{x_0\}, f(x) > f(x_0) + f'(x_0) (x - x_0)$。

感性理解：内点处的切线不会到凸函数“上面”去。

证明（非严格）：

- **注意：这里没有要求 $f$ 在 $[a, b]$ 上二阶可导，不能直接用带 Lagrange 余项的二阶 Taylor 公式！**
- $\Rightarrow$：由 $f$ 是 $[a, b]$ 上的凸函数，可知 $f'$ 在 $(a, b)$ 上单调递增。
- 由 Lagrange 中值定理和 $f'$ 的单调性可知：

$$
\forall x_0 \in (a, b),
\begin{cases}
\forall x \in [a, x_0), \exists \xi \in (x, x_0), \text{s.t. } f(x) = f(x_0) + f'(\xi) (x - x_0) \geq f(x_0) + f'(\xi) (x - x_0) \\
\forall x \in (x_0, b], \exists \xi \in (x_0, x), \text{s.t. } f(x) = f(x_0) + f'(\xi) (x - x_0) \geq f(x_0) + f'(\xi) (x - x_0)
\end{cases}
$$

- 整理一下，即 $\forall x_0 \in (a, b), \forall x \in [a, b], f(x) \geq f(x_0) + f'(x_0) (x - x_0)$，遂得证。
- $\Leftarrow$：_Motivation：我想构造出凸函数定义中的形式，考虑让 $x_0$ 取为中间点，并通过配置系数将 $f'(x_0)$ 消除。_
- $\forall a < x_1 < x_0 < x_2 < b$，令 $\gamma = \dfrac{x_2 - x_0}{x_2 - x_1} \in (0, 1)$，则 $x_0 = \gamma x_1 + (1 - \gamma) x_2$。
- 分别列出 $x = x_1$ 和 $x = x_2$ 时，条件中的不等式：

$$
\begin{cases}
f(x_1) \geq f(x_0) + f'(x_0) (x_1 - x_0) = f(x_0) - f'(x_0) \cdot (1 - \gamma) (x_2 - x_1) \ (1) \\
f(x_2) \geq f(x_0) + f'(x_0) (x_2 - x_0) = f(x_0) + f'(x_0) \cdot \gamma (x_2 - x_1) \ (2)
\end{cases}
$$

- 写出 $\gamma \cdot (1) + (1 - \gamma) \cdot (2)$：

$$
\begin{aligned}
&\gamma f(x_1) + (1 - \gamma) f(x_2) \geq f(x_0) \\
\Leftrightarrow &f(\gamma x_1 + (1 - \gamma) x_2) \leq \gamma f(x_1) + (1 - \gamma) f(x_2)
\end{aligned}
$$

- 由 $x_1, x_2$ 的任意性可知 $f$ 是 $[a, b]$ 上的凸函数。

而对于严格的情况，由于这里不涉及取极限，将不等号改成严格的即可。

### 定义：拐点

若 $f$ 在 $U(x_0)$ 上连续，在 $U^-(x_0)$ 上是凸（凹）函数、在 $U^+(x_0)$ 上是凹（凸）函数，则称 $x_0$ 为 $f$ 的一个拐点。

- **注意：拐点不是单调性发生变化的点，而是凹凸性发生变化的点！**

### 拐点与导数

#### 定理（拐点的二阶导数）

内容：若 $x_0$ 是 $f$ 的一个拐点，且 $f''(x_0)$ 存在，则 $f''(x_0) = 0$。

- **注意：这句话反过来并不成立，如当 $f(x) = x^4$，有 $f''(0) = 0$，但 $0$ 不是 $f$ 的拐点。**

证明：

- 由 $f''(x_0)$ 存在可知 $f'$ 在 $U(x_0)$ 上存在。
- **注意：需要先声明 $f$ 在 $U(x_0)$ 上可导，然后才能给出凹凸性对应的一阶导数的性质！**
- 由 $x_0$ 是拐点可知 $f'$ 在 $U^-(x_0)$ 上与 $f'$ 在 $U^+(x_0)$ 上的单调性相反。
- 故 $x_0$ 是 $f'$ 的一个极值点，又由 $f''(x_0)$ 存在可知 $f''(x_0) = 0$。

#### 定理（三阶导数判据）

内容：若 $f''(x_0) = 0, f'''(x_0) \neq 0$，则 $x_0$ 是 $f$ 的一个拐点。

证明：

- 由 $f'''(x_0)$ 存在可知 $f''$ 在 $U(x_0)$ 上存在。
- 由无穷小增量公式可知 $f''(x) = f''(x_0) + f'''(x_0) (x - x_0) + o(x - x_0) = f'''(x_0) (x - x_0) + o(x - x_0) \ (x \to x_0)$。
- 故 $f''$ 在 $U^-(x_0), U^+(x_0)$ 上的符号相反且非零，则 $f'$ 在 $U^-(x_0), U^+(x_0)$ 上的凹凸性不同。
- 故 $x_0$ 是 $f$ 的一个拐点。
