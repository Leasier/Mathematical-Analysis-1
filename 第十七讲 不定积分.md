# 第十七讲 不定积分

### 定义：原函数、可积与不定积分

给定在区间 $I$ 上有定义的 $f$，若 $F$ 在 $I$ 上连续，在 $I^0$ 上可导，且 $\forall x \in I^0, F'(x) = f(x)$，则称 $F$ 为 $f$ 的在 $I$ 上的一个原函数。

- 不强调区间 $I$ 时，也简称 $F$ 为 $f$ 的一个原函数。

若 $f$ 在区间 $I$ 上的原函数存在，则称 $f$ 在 $I$ 上可积。

称 $f$ 的**全部**原函数为 $f$ 的不定积分，记作 $\displaystyle\int f(x) \text{d} x$，在该式中称 $f$ 为被积函数。

#### 定理（原函数的形式）

内容：若 $F$ 为 $f$ 的一个原函数，则 $\displaystyle\int f(x) \text{d} x = F(x) + C$，这里 $C$ 表示一个常数。

证明：

- $\forall C \in \mathbb{R}, (F(x) + C)' = F'(x) = f(x)$，则 $F(x) + C$ 为 $f(x)$ 的一个原函数。
- 若 $G$ 为 $f$ 的另一个原函数，则 $(G(x) - F(x))' = G'(x) - F'(x) \equiv 0$，故 $\exists C \in \mathbb{R}, G(x) - F(x) \equiv C$，即 $G(x) = F(x) + C$。
- 综上，$\displaystyle\int f(x) \text{d} x = F(x) + C$。

------

由该定理可知，只需求出一个原函数，即可得到所有原函数。

### 不定积分表

$$
\begin{aligned}
&\int 0 \text{d} x = C &\quad &\int 1 \text{d} x = x + C \\
&\int x^{\alpha} \text{d} x = \dfrac{x^{\alpha + 1}}{\alpha + 1} + C \ (\alpha \neq -1) &\quad &\int x^{-1} \text{d} x = \ln |x| + C \\
&\int \frac{1}{x - a} \text{d} x = \ln |x - a| + C &\quad &\int e^x \text{d} x = e^x + C \\
&\int a^x \text{d} x = \frac{a^x}{\ln a} + C \ (a > 0, a \neq 1) &\quad &\int \sin x \text{d} x = -\cos x + C \\
&\int \cos x \text{d} x = \sin x + C &\quad &\int \frac{1}{\sin^2 x} \text{d} x = -\cot x + C \\
&\int \frac{1}{\cos^2 x} \text{d} x = \tan x + C &\quad &\int \frac{1}{1 + x^2} \text{d} x = \arctan x + C \\
&\int \frac{1}{\sqrt{1 - x^2}} \text{d} x = \arcsin x + C &\quad &\int \frac{1}{\sqrt{x^2 + a}} \text{d} x = \ln |x + \sqrt{x^2 + a^2}| + C \\
&\int \sinh x \text{d} x = \cosh x + C &\quad &\int \cosh x \text{d} x = \sinh x + C
\end{aligned}
$$

其中 $\sinh x = \dfrac{e^x - e^{-x}}{2}, \cosh x = \dfrac{e^x + e^{-x}}{2}$。

### 不定积分的基本性质

- (1) $\dfrac{\text{d}}{\text{d} x} \displaystyle\int f(x) \text{d} x = f(x)$，即先积分再微分不改变原函数。
- (2) $\displaystyle\int F'(x) \text{d} x = \displaystyle\int \text{d} F(x) = F(x) + C$，即先微分再积分得到与原函数相差常数的函数类。
- (3) 线性性：则：$\displaystyle\int (\alpha f(x) + \beta g(x)) \text{d} x = \alpha \int f(x) \text{d} x + \beta \int g(x) \text{d} x + C$。

[例 1] 求 $\displaystyle\int \tan^2 x \text{d} x$。

$$
\begin{aligned}
\int \tan^2 x \text{d} x &= \int \frac{\sin^2 x}{\cos^2 x} \text{d} x \\
&= \int \frac{1}{\cos^2 x} \text{d} x - \int 1 \cdot \text{d} x \\
&= \tan x - x + C
\end{aligned}
$$

[例 2] 求 $\displaystyle\int \frac{1}{x^4 - 1} \text{d} x$。

$$
\begin{aligned}
\frac{1}{x^4 - 1} \text{d} x &= \frac{1}{2} \int \frac{1}{x^2 - 1} \text{d} x - \frac{1}{2} \int \frac{1}{x^2 + 1} \text{d} x \\
&= \frac{1}{4} \int \frac{1}{x - 1} \text{d} x - \frac{1}{4} \int \frac{1}{x + 1} \text{d} x - \frac{1}{2} \int \frac{1}{x^2 + 1} \text{d} x \\
&= \frac{1}{4} \ln |x - 1| - \frac{1}{4} \ln |x + 1| - \frac{1}{2} \arctan x + C \\
&= \frac{1}{4} \ln |\frac{x - 1}{x + 1}| - \frac{1}{2} \arctan x + C
\end{aligned}
$$

### 重要的积分方法

#### 第一换元法：逆用复合函数求导

若 $F$ 为 $f$ 的原函数，则 $(F \circ u)'(x) = f(u(x)) u'(x)$，且有：

$$
\int f(u(x)) u'(x) \text{d} x = F(u(x)) + C
$$

- 若将 $\text{d} x$ 视作微分算子，则 $f(u(x)) u'(x) \text{d} x = f(u) \text{d} u$，这样理解的话就更显然了。

[例 3] 求 $\displaystyle\int \frac{x}{1 + x^2} \text{d} x$。

$$
\begin{aligned}
\int \frac{x}{1 + x^2} \text{d} x &= \frac{1}{2} \int \frac{1}{1 + x^2} \text{d} (x^2) \\
&= \frac{1}{2} \int \frac{1}{1 + u} \text{d} u &\quad (u = x^2) \\
&= \frac{1}{2} \ln |1 + u| + C \\
&= \frac{1}{2} \ln (1 + x^2) + C
\end{aligned}
$$

[例 4] 求 $\displaystyle\int \frac{1}{a^2 + x^2} \text{d} x$。

$$
\begin{aligned}
\int \frac{1}{a^2 + x^2} \text{d} x &= \frac{1}{a^2} \int \frac{1}{1 + (\frac{x}{a})^2} \text{d} x \\
&= \frac{1}{a} \int \frac{1}{1 + (\frac{x}{a})^2} \text{d} (\frac{x}{a}) \\
&= \frac{1}{a} \int \frac{1}{1 + u^2} \text{d} u &\quad (u = \frac{x}{a}) \\
&= \frac{1}{a} \arctan u + C \\
&= \frac{1}{a} \arctan \frac{x}{a} + C
\end{aligned}
$$

[例 5] 求 $\displaystyle\int \frac{1}{\sqrt{x(1 - x)}} \text{d} x$。

法一：

- _Motivation：要是把 $x, 1 - x$ 这对“双变量”变成单变量是不是就好了？比如说，配方？_

$$
\begin{aligned}
\int \frac{1}{\sqrt{x(1 - x)}} \text{d} x &= \int \frac{1}{\sqrt{\frac{1}{4} - (x - \frac{1}{2})^2}} \text{d} x \\
&= 2 \int \frac{1}{\sqrt{1 - (2x - 1)^2}} \text{d} x \\
&= \int \frac{1}{\sqrt{1 - (2x - 1)^2}} \text{d} (2x - 1) \\
&= \int \frac{1}{\sqrt{1 - u^2}} \text{d} u &\quad (u = 2x - 1) \\
&= \arcsin u + C \\
&= \arcsin (2x - 1) + C
\end{aligned}
$$

法二：

- _Motivation：诶，这个 $\dfrac{1}{\sqrt{x}}$ 是不是能跟 $\text{d} x$ 放一起？_

$$
\begin{aligned}
\int \frac{1}{\sqrt{x(1 - x)}} \text{d} x &= \int \frac{1}{\sqrt{1 - x}} \cdot \frac{\text{d} x}{\sqrt{x}} \\
&= 2 \int \frac{1}{\sqrt{1 - x}} \text{d} (\sqrt{x}) \\
&= 2 \int \frac{1}{\sqrt{1 - u^2}} \text{d} u &\quad (u = \sqrt{x}) \\
&= 2 \arcsin u + C \\
&= 2 \arcsin \sqrt{x} + C
\end{aligned}
$$

------

有趣的是，上面两种方法给出的答案并不一致，原因在于 $\sin$ 的**二倍角公式**：

$$
\sin (2 \arcsin \sqrt{x}) = 1 - 2 \sin^2 (\arcsin \sqrt{x}) = 1 - 2x \Rightarrow 2 \arcsin \sqrt{x} = \arcsin (1 - 2x)
$$

[例 6] 求 $\{I_n\}$ 的迭代式，其中 $I_n = \displaystyle\int \tan^n x \text{d} x$。

首先有 $I_0 = x + C$，接下来计算 $I_1$：

$$
\begin{aligned}
I_1 &= \int \tan x \text{d} x \\
&= \int \frac{\sin x}{\cos x} \text{d} x \\
&= -\int \frac{1}{\cos x} \text{d} (\cos x) \\
&= -\ln |\cos x| + C
\end{aligned}
$$

接下来仿照例 1 中对线性性的运用迭代出 $n \geq 2$ 时的 $I_n$：

$$
\begin{aligned}
I_n &= \int \tan^n x \text{d} x \\
&= \int \tan^{n - 2} x (\frac{1}{\cos^2 x} - 1) \text{d} x \\
&= \int \tan^{n - 2} x \cdot \frac{1}{\cos^2 x} \cdot \text{d} x - \int \tan^{n - 2} x \text{d} x \\
&= \int \tan^{n - 2} x \text{d} (\tan x) - I_{n - 2} \\
&= \frac{\tan^{n - 1} x}{n - 1} - I_{n - 2}
\end{aligned}
$$

故可通过 $I_0$ 推出所有 $n$ 为偶数的 $I_n$、通过 $I_1$ 推出所有 $n$ 为奇数的 $I_n$。

[例 7] 求 $\displaystyle\int \frac{1}{1 + \cos^2 x} \text{d} x$。

- _Motivation：已知 $\dfrac{1}{\cos^2 x} \text{d} x = \text{d} (\tan x)$，能不能尝试提出分母里的 $\cos^2 x$？_

$$
\begin{aligned}
\int \frac{1}{1 + \cos^2 x} \text{d} x &= \int \frac{1}{\frac{1}{\cos^2 x} + 1} \cdot \dfrac{1}{\cos^2 x} \cdot \text{d} x \\
&= \int \frac{1}{\tan^2 x + 2} \text{d} (\tan x) \\
&= \frac{1}{\sqrt{2}} \int \frac{1}{(\frac{\tan x}{\sqrt{2}})^2 + 1} \text{d} (\frac{\tan x}{\sqrt{2}}) \\
&= \frac{1}{\sqrt{2}} \arcsin (\frac{\tan x}{\sqrt{2}}) + C
\end{aligned}
$$

[例 8] 求 $\displaystyle\int \frac{1}{1 + x^4} \text{d} x$。

法一：因式分解

- 注意到 $1 + x^4 = (x^2 - \sqrt{2} x + 1)(x^2 + \sqrt{2} x + 1)$，通过待定系数法可以解出：

$$
\int \frac{1}{1 + x^4} \text{d} x = \int \frac{\frac{1}{2 \sqrt{2}} x + \frac{1}{2}}{x^2 - \sqrt{2} x + 1} \text{d} x - \int \frac{-\frac{1}{2 \sqrt{2}} x + \frac{1}{2}}{x^2 + \sqrt{2} x + 1} \text{d} x
$$

- 对第一项换元 $u = x - \dfrac{1}{\sqrt{2}}$ 可得：

$$
\begin{aligned}
\int \frac{\frac{1}{2 \sqrt{2}} x + \frac{1}{2}}{x^2 - \sqrt{2} x + 1} \text{d} x &= \int \frac{\frac{1}{2 \sqrt{2}} u + \frac{1}{4}}{u^2 + \frac{1}{2}} \text{d} u \\
&= \frac{1}{2 \sqrt{2}} \int \frac{u}{u^2 + \frac{1}{2}} \text{d} u + \frac{1}{4} \int \frac{1}{u^2 + \frac{1}{2}} \text{d} u \\
&= \frac{1}{4 \sqrt{2}} \int \frac{1}{u^2 + \frac{1}{2}} \text{d} (u^2) + \frac{1}{2 \sqrt{2}} \int \frac{1}{(\sqrt{2} u)^2 + 1} \text{d} (\sqrt{2} u) \\
&= \frac{1}{4 \sqrt{2}} \ln |u^2 + \frac{1}{2}| + \frac{1}{2 \sqrt{2}} \arctan (\sqrt{2} u) + C \\
&= \frac{1}{4 \sqrt{2}} \ln (x^2 - \sqrt{2} x + 1) + \frac{1}{2 \sqrt{2}} \arctan (\sqrt{2} x - 1) + C
\end{aligned}
$$

- 对第二项换元 $v = x + \dfrac{1}{\sqrt{2}}$ 可得：

$$
\int \frac{-\frac{1}{2 \sqrt{2}} x + \frac{1}{2}}{x^2 + \sqrt{2} x + 1} \text{d} x = \frac{1}{4 \sqrt{2}} \ln (x^2 + \sqrt{2} x + 1) + \frac{1}{2 \sqrt{2}} \arctan (-\sqrt{2} x - 1) + C
$$

- 故所求即为：

$$
\int \frac{1}{1 + x^4} \text{d} x = \frac{1}{4 \sqrt{2}} \ln \frac{x^2 - \sqrt{2} x + 1}{x^2 + \sqrt{2} x + 1} + \frac{1}{2 \sqrt{2}} \arctan (\sqrt{2} x - 1) + \frac{1}{2 \sqrt{2}} \arctan (\sqrt{2} x + 1) + C
$$

法二：~~人类智慧~~回文构造

- 设 $F(x) = \displaystyle\int \frac{1}{1 + x^4} \text{d} x, G(x) = \displaystyle\int \frac{x^2}{1 + x^4} \text{d} x$。
- 首先计算 $F(x) + G(x)$：

$$
\begin{aligned}
F(x) + G(x) &= \int \frac{1 + x^2}{1 + x^4} \text{d} x \\
&= \int \frac{1 + \frac{1}{x^2}}{x^2 + \frac{1}{x^2}} \text{d} x \\
&= \int \frac{1}{u^2 + 2} \text{d} u &\quad (u = x - \frac{1}{x}) \\
&= \frac{1}{\sqrt{2}} \int \frac{1}{(\frac{u}{\sqrt{2}})^2 + 1} \text{d} (\frac{u}{\sqrt{2}}) \\
&= \frac{1}{\sqrt{2}} \arctan (\frac{u}{\sqrt{2}}) + C \\
&= \frac{1}{\sqrt{2}} \arctan (\frac{x - \frac{1}{x}}{\sqrt{2}}) + C
\end{aligned}
$$

- 接下来计算 $F(x) - G(x)$：

$$
\begin{aligned}
F(x) + G(x) &= \int \frac{1 - x^2}{1 + x^4} \text{d} x \\
&= \int \frac{1 - \frac{1}{x^2}}{x^2 + \frac{1}{x^2}} \text{d} x \\
&= \int \frac{1}{v^2 - 2} \text{d} v &\quad (v = x + \frac{1}{x}) \\
&= \frac{1}{\sqrt{2}} \int \frac{1}{(\frac{v}{\sqrt{2}})^2 - 1} \text{d} (\frac{v}{\sqrt{2}}) \\
&= \frac{1}{2 \sqrt{2}} \ln |\frac{\frac{v}{\sqrt{2}} - 1}{\frac{v}{\sqrt{2}} + 1}| + C \\
&= \frac{1}{2 \sqrt{2}} \ln |\frac{x^2 - \sqrt{2} x + 1}{x^2 + \sqrt{2} x + 1}| + C \\
&= \frac{1}{2 \sqrt{2}} \ln (\frac{x^2 - \sqrt{2} x + 1}{x^2 + \sqrt{2} x + 1}) + C
\end{aligned}
$$

- 故有：

$$
\begin{aligned}
F(x) &= \frac{1}{2} ((F(x) + G(x)) + (F(x) - G(x))) \\
&= \frac{1}{2 \sqrt{2}} \arctan (\frac{x - \frac{1}{x}}{\sqrt{2}}) + \frac{1}{4 \sqrt{2}} \ln (\frac{x^2 - \sqrt{2} x + 1}{x^2 + \sqrt{2} x + 1}) + C
\end{aligned}
$$

------

两种方法得出的结果（至少在形式上）并不一致，这是怎么回事呢？

- 令 $\alpha = \arctan (\sqrt{2} x - 1), \beta = \arctan (\sqrt{2} x + 1)$，则：

$$
\begin{aligned}
\tan (\alpha + \beta) &= \dfrac{(\sqrt{2} x - 1) + (\sqrt{2} x + 1)}{1 - (\sqrt{2} x - 1)(\sqrt{2} x + 1)} \\
&= \frac{\sqrt{2} x}{1 - x^2}
\end{aligned}
$$

- 注意到这刚好就是 $\dfrac{x - \frac{1}{x}}{\sqrt{2}}$ 的倒数的相反数，故 $\arctan (\dfrac{x - \frac{1}{x}}{\sqrt{2}}) = (\alpha + \beta) + k \pi$，两个结果之间只相差 $\dfrac{k \pi}{2 \sqrt{2}}$。
- **等一下，这个 $k$ 是常数吗？**

如果把两个函数的图像分别画出来，问题就出现了：

- 当 $x < 0$，法二的代表元比法一的大 $\dfrac{\pi}{4 \sqrt{2}}$。
- 当 $x = 0$，法二的代表元**没有定义**。
- 当 $x > 0$，法二的代表元比法一的小 $\dfrac{\pi}{4 \sqrt{2}}$。

问题就在于，$\dfrac{1}{1 + x^4}$ 在 $x = 0$ 处有定义，但法一的代表元在 $x = 0$ 处没有定义，导致两边“断开”了。

因此，需要对法二的结果作如下修正以使之连续：

$$
F(x) = C + \begin{cases}
\dfrac{1}{2 \sqrt{2}} \arctan (\dfrac{x - \frac{1}{x}}{\sqrt{2}}) + \dfrac{1}{4 \sqrt{2}} \ln (\dfrac{x^2 - \sqrt{2} x + 1}{x^2 + \sqrt{2} x + 1}) - \dfrac{\pi}{4 \sqrt{2}}, &\quad x < 0 \\
0, &\quad x = 0 \\
\dfrac{1}{2 \sqrt{2}} \arctan (\dfrac{x - \frac{1}{x}}{\sqrt{2}}) + \dfrac{1}{4 \sqrt{2}} \ln (\dfrac{x^2 - \sqrt{2} x + 1}{x^2 + \sqrt{2} x + 1}) + \dfrac{\pi}{4 \sqrt{2}}, &\quad x > 0
\end{cases}
$$

容易验证它确实是 $\dfrac{1}{1 + x^4}$ 的原函数。

- 可以通过计算 $\displaystyle\lim_{x \to 0^-} \frac{1}{2 \sqrt{2}} \arctan (\frac{x - \frac{1}{x}}{\sqrt{2}}), \lim_{x \to 0^+} \frac{1}{2 \sqrt{2}} \arctan (\frac{x - \frac{1}{x}}{\sqrt{2}})$ 之差的一半得到 $\dfrac{\pi}{4 \sqrt{2}}$ 这个数。

------

由于在 $\mathbb{R}$ 上对多项式因式分解总能得到一车一次式和一车有两个复根的二次式，法一可以推广到任何有理函数的积分。

注意到法二能成立依赖于 $x^4 + 1$ 的系数关于 $x^2$ 的对称性，其可以推广到任何形如 $\dfrac{Ax^2 + Bx + C}{x^4 + Dx^2 + 1}$ 的分式的积分。

#### 第二换元法：正用复合函数求导

对于区间 $I$，已知函数 $f : I \to \mathbb{R}$，若 $F$ 为 $f$ 的原函数，$\varphi : J \to I$ 可导且严格单调（即 $\forall x \in J, \varphi'(x) \neq 0$），则其反函数存在，且有：

$$
\int f(x) \text{d} x = F(\varphi^{-1}(x)) + C
$$

- 若令 $t = \varphi^{-1}(x)$ 即 $x = \varphi(t)$，则 $f(x) \text{d} x = f(x) \varphi(t) \text{d} t$，故结果为 $F(\varphi(t)) = F(x)$。

[例 9] 求 $\displaystyle\int \sqrt{a^2 - x^2} \text{d} x \ (a > 0, |x| \leq a)$。

- _Motivation：诶，圆的方程不就是 $x^2 + y^2 = a^2$ 吗？这个 $y$ 又可以表示为三角函数，试试对 $x$ 三角换元？_
- 令 $x = a \sin t \ (t \in [-\dfrac{\pi}{2}, \dfrac{\pi}{2}])$，由于 $\sin$ 在 $[-\dfrac{\pi}{2}, \dfrac{\pi}{2}]$ 上可导且严格单调递增，有：

$$
\begin{aligned}
\int \sqrt{a^2 - x^2} \text{d} x &= \int \sqrt{a^2 - a^2 \sin^2 t} \text{d} (a \sin t) \\
&= a^2 \int \cos t \text{d} (\sin t) \\
&= a^2 \int \cos^2 t \text{d} t \\
&= a^2 \int \frac{\cos 2t + 1}{2} \text{d} t \\
&= a^2 (\frac{\sin 2t}{4} + \frac{t}{2} + C) \\
&= \frac{a^2}{2} \sin t \cos t + \frac{a^2}{2} t + C \\
&= \frac{a^2}{2} \cdot \frac{x}{a} \cdot \sqrt{1 - (\frac{x}{a})^2} + \frac{a^2}{2} \arcsin \frac{x}{a} + C \\
&= \frac{x}{2} \sqrt{a^2 - x^2} + \frac{a^2}{2} \arcsin \frac{x}{a} + C
\end{aligned}
$$

[例 10] 求 $\displaystyle\int \frac{1}{\sqrt{x^2 - a^2}} \text{d} x \ (|x| > a > 0)$。

- _Motivation：诶，$x^2 - y^2 = a^2$ 不是双曲线的方程吗？能不能仿照双曲线的参数方程来三角换元？_
- 令 $x = a \sec t \ (t \in (0, \dfrac{\pi}{2}) \cup (\dfrac{\pi}{2}, \pi))$，由于 $\sec$ 在 $(0, \dfrac{\pi}{2}), (\dfrac{\pi}{2}, \pi)$ 上可导且分别严格单调递增，**在两区间上分别**有：

$$
\begin{aligned}
\int \frac{1}{\sqrt{x^2 - a^2}} \text{d} x &= \int \frac{1}{\sqrt{\frac{a^2}{\cos^2 t} - a^2}} \text{d} (\frac{a}{\cos t}) \\
&= \int \frac{|\cos t|}{a \sin t} \cdot \frac{a \sin t}{\cos^2 t} \text{d} t \\
&= \int \frac{1}{|\cos t|} \text{d} t
\end{aligned}
$$

- 由于出现了绝对值，下面分类讨论。
- (1) 当 $t \in (0, \dfrac{\pi}{2})$，有：

$$
\begin{aligned}
\int \frac{1}{|\cos t|} \text{d} t &= \int \frac{1}{\cos t} \text{d} t \\
&= \int \frac{1}{\cos^2 t} \text{d} (\sin t) \\
&= \int \frac{1}{1 - u^2} \text{d} u &\quad (u = \sin t) \\
&= \frac{1}{2} (\int \frac{1}{1 - u} \text{d} u + \int \frac{1}{1 + u} \text{d} u) \\
&= \frac{1}{2} (-\ln |u - 1| + \ln |u + 1|) + C \\
&= \frac{1}{2} \ln \frac{1 + \sin t}{1 - \sin t} + C \\
&= \frac{1}{2} \ln \frac{(1 + \sin t)^2}{\cos^2 t} + C \\
&= \ln |\frac{1 + \sin t}{\cos t}| + C \\
&= \ln (\sec t + \tan t) + C \\
&= \ln (\frac{x}{a} + \sqrt{(\frac{x}{a})^2 - 1}) + C \\
&= \ln (x + \sqrt{x^2 - a^2}) + C \\
\end{aligned}
$$

- _这里最后一步去掉了 $-\ln a$ 的常数，因为这是一个从 $C$ 到 $C$ 的一一映射。_
- (2) 当 $t \in (\dfrac{\pi}{2}, \pi)$，有：

$$
\begin{aligned}
\int \frac{1}{|\cos t|} \text{d} t &= -\int \frac{1}{\cos t} \text{d} t \\
&= -\int \frac{1}{1 - u^2} \text{d} u &\quad (u = \sin t) \\
&= -\frac{1}{2} (-\ln |u - 1| + \ln |u + 1|) + C \\
&= -\frac{1}{2} \ln \frac{1 + \sin t}{1 - \sin t} + C \\
&= -\ln |\frac{1 + \sin t}{\cos t}| + C \\
&= -\ln (-\sec t - \tan t) + C \\
&= -\ln (-\frac{x}{a} - (-\sqrt{(\frac{x}{a})^2 - 1})) + C \\
&= -\ln (-x + \sqrt{x^2 - a^2}) + C \\
&= \ln (-x - \sqrt{x^2 - a^2}) + C
\end{aligned}
$$

- 综上，$\displaystyle\int \frac{1}{\sqrt{x^2 - a^2}} \text{d} x = \ln |x + \sqrt{x^2 - a^2}| + C$。

[例 11] 求 $\displaystyle\int \frac{1}{\sqrt{x^2 + a^2}} \text{d} x \ (a > 0)$。

- _Motivation：$y^2 - x^2 = a^2$ 跟例 10 反过来了！不妨反过来三角换元。_
- 令 $x = a \tan t \ (t \in (-\dfrac{\pi}{2}, \dfrac{\pi}{2}))$，由于 $\tan$ 在 $(-\dfrac{\pi}{2}, \dfrac{\pi}{2})$ 上可导且严格单调递增，有：

$$
\begin{aligned}
\displaystyle\int \frac{1}{\sqrt{x^2 + a^2}} \text{d} x &= \int \frac{1}{\sqrt{a^2 \tan^2 t + a^2}} \text{d} (a \tan t) \\
&= \int \frac{\cos t}{a} \cdot \frac{a}{\cos^2 t} \text{d} t \\
&= \int \frac{1}{\cos t} \text{d} t \\
&= \ln (\sec t + \tan t) + C &\quad (同例 10 可知) \\
&= \ln (\sqrt{1 + (\frac{x}{a})^2} + \frac{x}{a}) + C \\
&= \ln (x + \sqrt{x^2 + a^2}) + C
\end{aligned}
$$

[例 12] 求 $\displaystyle\int \frac{1}{\sqrt{x} + \sqrt[3]{x}} \text{d} x$。

- _Motivation：这个根式好烦啊，能不能变成整式？_
- 原积分中 $x \in (0, +\infty)$，令 $x = t^6 \ (t \in (0, +\infty))$，由于幂函数在 $(0, +\infty)$ 上可导且严格单调递增，有：

$$
\begin{aligned}
\int \frac{1}{\sqrt{x} + \sqrt[3]{x}} \text{d} x &= \int \frac{1}{t^3 + t^2} \text{d} (t^6) \\
&= 6 \int \frac{t^3}{t + 1} \text{d} t \\
&= 6 (\int (t^2 - t + 1) \text{d} t - \int \frac{1}{t + 1} \text{d} t) \\
&= 6 (\frac{1}{3} t^3 - \frac{1}{2} t^2 + t - \ln |t + 1| + C) \\
&= 2 \sqrt{x} - 3 \sqrt[3]{x} + 6 \sqrt[6]{x} - 6 \ln (\sqrt[6]{x} + 1) + C
\end{aligned}
$$

#### 分部积分法：逆用乘积函数求导

若 $u, v$ 可导且 $\displaystyle\int u'(x) v(x) \text{d} x$ 存在，则有：

$$
\int u(x) v'(x) \text{d} x = u(x) v(x) - \int u'(x) v(x) \text{d} x
$$

也可写作：

$$
\int u(x) \text{d} (v(x)) = u(x) v(x) - \int \text{d} (u(x)) v(x) 
$$

[例 13] 求 $\displaystyle\int x e^{-x} \text{d} x$。

$$
\begin{aligned}
\int x e^{-x} \text{d} x &= -\int x \text{d} (e^{-x}) \\
&= -(xe^{-x} - \int e^{-x} \text{d} x) \\
&= -(xe^{-x} - (-e^{-x} + C)) \\
&= -(x + 1) e^{-x} + C
\end{aligned}
$$

[例 14] 求 $\displaystyle\int x^2 \sin x \text{d} x$。

$$
\begin{aligned}
\int x^2 \sin x \text{d} x &= -\int x^2 \text{d} (\cos x) \\
&= -(x^2 \cos x - \int \cos x \text{d} (x^2)) \\
&= -x^2 \cos x + 2 \int x \cos x \text{d} x \\
&= -x^2 \cos x + 2 \int x \text{d} (\sin x) \\
&= -x^2 \cos x + 2(x \sin x - \int \sin x \text{d} x) \\
&= -x^2 \cos x + 2(x \sin x + \cos x + C) \\
&= -x^2 \cos x + 2x \sin x + 2 \cos x + C
\end{aligned}
$$

- 有趣的是，本题中我们第一次使用分部积分法将 $x^2 \sin x$ 的不定积分转化为 $x \cos x$ 的不定积分，第二次使用分部积分法将 $x \cos x$ 的不定积分转化为 $\sin x$ 的不定积分，实现了“降次”的效果。

[例 15] 求 $\displaystyle\int \ln x \text{d} x$。

$$
\begin{aligned}
\int \ln x \text{d} x &= x \ln x - \int x \text{d} (\ln x) \\
&= x \ln x - \int 1 \cdot \text{d} x \\
&= x \ln x - x + C
\end{aligned}
$$

[例 16] 求 $\displaystyle\int \sqrt{x^2 - 1} \text{d} x$。

$$
\begin{aligned}
\int \sqrt{x^2 - 1} \text{d} x &= x \sqrt{x^2 - 1} - \int x \text{d} (\sqrt{x^2 - 1}) \\
&= x \sqrt{x^2 - 1} - \int \frac{x^2}{\sqrt{x^2 - 1}} \text{d} x \\
&= x \sqrt{x^2 - 1} - (\int \sqrt{x^2 - 1} \text{d} x + \int \frac{1}{\sqrt{x^2 - 1}} \text{d} x) \\
&= x \sqrt{x^2 - 1} - \int \sqrt{x^2 - 1} \text{d} x - (\ln |x + \sqrt{x^2 - 1}| + C) &\quad (由例 10 可知)
\end{aligned}
$$

- _Motivation：虽然右边也出现了 $\displaystyle\int \sqrt{x^2 - 1} \text{d} x$，但没有抵消啊！能不能移到左边来构建方程？_
- 移项化简可得：

$$
\int \sqrt{x^2 - 1} \text{d} x = \frac{1}{2} x \sqrt{x^2 - 1} - \frac{1}{2} \ln |x + \sqrt{x^2 - 1}| + C
$$

[例 17] 求 $\displaystyle\int e^{ax} \cos (bx) \text{d} x \ (a, b \neq 0)$。

$$
\begin{aligned}
\int e^{ax} \cos (bx) \text{d} x &= \frac{1}{a} \int \cos (bx) \text{d} (e^{ax}) \\
&= \frac{1}{a} (e^{ax} \cos (bx) - \int e^{ax} \text{d} (\cos (bx))) \\
&= \frac{1}{a} (e^{ax} \cos (bx) + b \int e^{ax} \sin (bx) \text{d} x) \\
&= \frac{1}{a} (e^{ax} \cos (bx) + \frac{b}{a} \int \sin (bx) \text{d} (e^{ax})) \\
&= \frac{1}{a} (e^{ax} \cos (bx) + \frac{b}{a} (e^{ax} \sin (bx) - \int e^{ax} \text{d} (\sin (bx)))) \\
&= \frac{1}{a} (e^{ax} \cos (bx) + \frac{b}{a} (e^{ax} \sin (bx) - b \int e^{ax} \cos (bx) \text{d} x)) \\
\end{aligned}
$$

- 移项化简可得：

$$
\int e^{ax} \cos (bx) \text{d} x = \frac{e^{ax} (a \cos (bx) + b \sin (bx))}{a^2 + b^2} + C
$$

- 有趣的是，本题中 $e^{ax}, \cos (bx)$ 两个函数蕴含某种“积分下的形式不变性”——前者始终为 $\dfrac{1}{a^k} e^{ax}$，后者始终为 $\pm \dfrac{1}{b^k} \cos(bx), \pm \dfrac{1}{b^k} \sin(bx)$ 之一。这其实已经暗示我们可以通过反复施用分部积分法求解。

[例 18] 求 $I_n = \displaystyle\int \frac{1}{(x^2 + a^2)^n} \text{d} x \ (a \neq 0)$ 的递推式。

- 首先求解 $I_1$：

$$
\begin{aligned}
I_1 &= \int \frac{1}{x^2 + a^2} \text{d} x \\
&= \frac{1}{a} \int \frac{1}{(\frac{x}{a})^2 + 1} \text{d} (\frac{x}{a}) \\
&= \frac{1}{a} \arctan (\frac{x}{a}) + C
\end{aligned}
$$

- 接下来求解 $I_n \ (n > 1)$：

$$
\begin{aligned}
I_n &= \frac{x}{(x^2 + a^2)^n} - \int x \text{d} (\frac{1}{(x^2 + a^2)^n}) \\
&= \frac{x}{(x^2 + a^2)^n} - 2n \int \frac{x^2}{(x^2 + a^2)^{n + 1}} \text{d} x \\
&= \frac{x}{(x^2 + a^2)^n} - 2n (\int \frac{1}{(x^2 + a^2)^n} \text{d} x - \int \frac{a^2}{(x^2 + a^2)^{n + 1}} \text{d} x) \\
&= 2n a^2 I_{n + 1} - 2n I_n + \frac{x}{(x^2 + a^2)^n}
\end{aligned}
$$

- 注意到这个式子事实上在 $I_n$ 和 $I_{n + 1}$ 间建立了关联，不妨改口 $n \in \mathbb{N}_+$（显然不影响上述过程的正确性），得到如下递推式：

$$
I_{n + 1} = \frac{1}{2n a^2} ((2n + 1) I_n - \frac{x}{(x^2 + a^2)^n})
$$
