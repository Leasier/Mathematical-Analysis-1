# 第十七讲 不定积分

### 定义：原函数、可积与不定积分

给定在区间 $I$ 上有定义的 $f$，若 $F$ 在 $I$ 上连续，在 $I^0$ 上可导，且 $\forall x \in I^0, F'(x) = f(x)$，则称 $F$ 为 $f$ 的在 $I$ 上的一个原函数。

- 不强调区间 $I$ 时，也简称 $F$ 为 $f$ 的一个原函数。

若 $f$ 在区间 $I$ 上的原函数存在，则称 $f$ 在 $I$ 上可积。

称 $f$ 的**全部**原函数为 $f$ 的不定积分，记作 $\displaystyle\int f(x) \text{d} x$，在该式中称 $f$ 为被积函数。

#### 定理（原函数的形式）

内容：若 $F$ 为 $f$ 的一个原函数，则 $\displaystyle\int f(x) \text{d} x = F(x) + C$，这里 $C$ 表示一个常数。

证明：

- $\forall C \in \mathbb{R}, (F(x) + C)' = F'(x) = f(x)$，则 $F(x) + C$ 为 $f(x)$ 的一个原函数。
- 若 $G$ 为 $f$ 的另一个原函数，则 $(G(x) - F(x))' = G'(x) - F'(x) \equiv 0$，故 $\exists C \in \mathbb{R}, G(x) - F(x) \equiv C$，即 $G(x) = F(x) + C$。
- 综上，$\displaystyle\int f(x) \text{d} x = F(x) + C$。

------

由该定理可知，只需求出一个原函数，即可得到所有原函数。

### 不定积分表

$$
\begin{aligned}
&\int 0 \cdot \text{d} x = C &\quad &\int 1 \cdot \text{d} x = x + C \\
&\int x^{\alpha} \text{d} x = \dfrac{x^{\alpha + 1}}{\alpha + 1} + C \ (\alpha \neq -1) &\quad &\int x^{-1} \text{d} x = \ln |x| + C \\
&\int \frac{1}{x - a} \text{d} x = \ln |x - a| + C &\quad &\int e^x \text{d} x = e^x + C \\
&\int a^x \text{d} x = \frac{a^x}{\ln a} + C \ (a > 0, a \neq 1) &\quad &\int \sin x \text{d} x = -\cos x + C \\
&\int \cos x \text{d} x = \sin x + C &\quad &\int \frac{1}{\sin^2 x} \text{d} x = -\cot x + C \\
&\int \frac{1}{\cos^2 x} \text{d} x = \tan x + C &\quad &\int \frac{1}{a^2 + x^2} \text{d} x = \frac{1}{a} \arctan \frac{x}{a} + C \\
&\int \frac{1}{\sqrt{a^2 - x^2}} \text{d} x = \arcsin \frac{x}{a} + C \ (a > 0) &\quad &\int \frac{1}{\sqrt{a^2 + x^2}} \text{d} x = \ln (x + \sqrt{a^2 + x^2}) + C \\
&\int \sinh x \text{d} x = \cosh x + C &\quad &\int \cosh x \text{d} x = \sinh x + C
\end{aligned}
$$

其中 $\sinh x = \dfrac{e^x - e^{-x}}{2}, \cosh x = \dfrac{e^x + e^{-x}}{2}$。

### 不定积分的基本性质

- (1) $\dfrac{\text{d}}{\text{d} x} \displaystyle\int f(x) \text{d} x = f(x)$，即先积分再微分不改变原函数。
- (2) $\displaystyle\int F'(x) \text{d} x = \displaystyle\int \text{d} F(x) = F(x) + C$，即先微分再积分得到与原函数相差常数的函数类。
- (3) 线性性：则：$\displaystyle\int (\alpha f(x) + \beta g(x)) \text{d} x = \alpha \int f(x) \text{d} x + \beta \int g(x) \text{d} x + C$。

[例 1] 求 $\displaystyle\int \tan^2 x \text{d} x$。

$$
\begin{aligned}
\int \tan^2 x \text{d} x &= \int \frac{\sin^2 x}{\cos^2 x} \text{d} x \\
&= \int \frac{1}{\cos^2 x} \text{d} x - \int 1 \cdot \text{d} x \\
&= \tan x - x + C
\end{aligned}
$$

[例 2] 求 $\displaystyle\int \frac{1}{x^4 - 1} \text{d} x$。

$$
\begin{aligned}
\frac{1}{x^4 - 1} \text{d} x &= \frac{1}{2} \int \frac{1}{x^2 - 1} \text{d} x - \frac{1}{2} \int \frac{1}{x^2 + 1} \text{d} x \\
&= \frac{1}{4} \int \frac{1}{x - 1} \text{d} x - \frac{1}{4} \int \frac{1}{x + 1} \text{d} x - \frac{1}{2} \int \frac{1}{x^2 + 1} \text{d} x \\
&= \frac{1}{4} \ln |x - 1| - \frac{1}{4} \ln |x + 1| - \frac{1}{2} \arctan x + C \\
&= \frac{1}{4} \ln |\frac{x - 1}{x + 1}| - \frac{1}{2} \arctan x + C
\end{aligned}
$$

### 重要的积分方法

#### 第一换元法：逆用复合函数求导

若 $F$ 为 $f$ 的原函数，则 $(F \circ u)'(x) = f(u(x)) u'(x)$，且有：

$$
\int f(u(x)) u'(x) \text{d} x = F(u(x)) + C
$$

- 若将 $\text{d} x$ 视作微分算子，则 $f(u(x)) u'(x) \text{d} x = f(u) \text{d} u$，这样理解的话就更显然了。

[例 3] 求 $\displaystyle\int \frac{x}{1 + x^2} \text{d} x$。

$$
\begin{aligned}
\int \frac{x}{1 + x^2} \text{d} x &= \frac{1}{2} \int \frac{1}{1 + x^2} \text{d} (x^2) \\
&= \frac{1}{2} \int \frac{1}{1 + u} \text{d} u &\quad (u = x^2) \\
&= \frac{1}{2} \ln |1 + u| + C \\
&= \frac{1}{2} \ln (1 + x^2) + C
\end{aligned}
$$

[例 4] 求 $\displaystyle\int \frac{1}{a^2 + x^2} \text{d} x$。

$$
\begin{aligned}
\int \frac{1}{a^2 + x^2} \text{d} x &= \frac{1}{a^2} \int \frac{1}{1 + (\frac{x}{a})^2} \text{d} x \\
&= \frac{1}{a} \int \frac{1}{1 + (\frac{x}{a})^2} \text{d} (\frac{x}{a}) \\
&= \frac{1}{a} \int \frac{1}{1 + u^2} \text{d} u &\quad (u = \frac{x}{a}) \\
&= \frac{1}{a} \arctan u + C \\
&= \frac{1}{a} \arctan \frac{x}{a} + C
\end{aligned}
$$

[例 5] 求 $\displaystyle\int \frac{1}{\sqrt{x(1 - x)}} \text{d} x$。

法一：

- _Motivation：要是把 $x, 1 - x$ 这对“双变量”变成单变量是不是就好了？比如说，配方？_

$$
\begin{aligned}
\int \frac{1}{\sqrt{x(1 - x)}} \text{d} x &= \int \frac{1}{\sqrt{\frac{1}{4} - (x - \frac{1}{2})^2}} \text{d} x \\
&= 2 \int \frac{1}{\sqrt{1 - (2x - 1)^2}} \text{d} x \\
&= \int \frac{1}{\sqrt{1 - (2x - 1)^2}} \text{d} (2x - 1) \\
&= \int \frac{1}{\sqrt{1 - u^2}} \text{d} u &\quad (u = 2x - 1) \\
&= \arcsin u + C \\
&= \arcsin (2x - 1) + C
\end{aligned}
$$

法二：

- _Motivation：诶，这个 $\dfrac{1}{\sqrt{x}}$ 是不是能跟 $\text{d} x$ 放一起？_

$$
\begin{aligned}
\int \frac{1}{\sqrt{x(1 - x)}} \text{d} x &= \int \frac{1}{\sqrt{1 - x}} \cdot \frac{\text{d} x}{\sqrt{x}} \\
&= 2 \int \frac{1}{\sqrt{1 - x}} \text{d} (\sqrt{x}) \\
&= 2 \int \frac{1}{\sqrt{1 - u^2}} \text{d} u &\quad (u = \sqrt{x}) \\
&= 2 \arcsin u + C \\
&= 2 \arcsin \sqrt{x} + C
\end{aligned}
$$

------

有趣的是，上面两种方法给出的答案并不一致，原因在于 $\sin$ 的**二倍角公式**：

$$
\sin (2 \arcsin \sqrt{x}) = 1 - 2 \sin^2 (\arcsin \sqrt{x}) = 1 - 2x \Rightarrow 2 \arcsin \sqrt{x} = \arcsin (1 - 2x)
$$

[例 6] 求 $\{I_n\}$ 的迭代式，其中 $I_n = \displaystyle\int \tan^n x \text{d} x$。

首先有 $I_0 = x + C$，接下来计算 $I_1$：

$$
\begin{aligned}
I_1 &= \int \tan x \text{d} x \\
&= \int \frac{\sin x}{\cos x} \text{d} x \\
&= -\int \frac{1}{\cos x} \text{d} (\cos x) \\
&= -\ln |\cos x| + C
\end{aligned}
$$

接下来仿照例 1 中对线性性的运用迭代出 $n \geq 2$ 时的 $I_n$：

$$
\begin{aligned}
I_n &= \int \tan^n x \text{d} x \\
&= \int \tan^{n - 2} x (\frac{1}{\cos^2 x} - 1) \text{d} x \\
&= \int \tan^{n - 2} x \cdot \frac{1}{\cos^2 x} \cdot \text{d} x - \int \tan^{n - 2} x \text{d} x \\
&= \int \tan^{n - 2} x \text{d} (\tan x) - I_{n - 2} \\
&= \frac{\tan^{n - 1} x}{n - 1} - I_{n - 2}
\end{aligned}
$$

故可通过 $I_0$ 推出所有 $n$ 为偶数的 $I_n$、通过 $I_1$ 推出所有 $n$ 为奇数的 $I_n$。

[例 7] 求 $\displaystyle\int \frac{1}{1 + \cos^2 x} \text{d} x$。

- _Motivation：已知 $\dfrac{1}{\cos^2 x} \text{d} x = \text{d} (\tan x)$，能不能尝试提出分母里的 $\cos^2 x$？_

$$
\begin{aligned}
\int \frac{1}{1 + \cos^2 x} \text{d} x &= \int \frac{1}{\frac{1}{\cos^2 x} + 1} \cdot \dfrac{1}{\cos^2 x} \cdot \text{d} x \\
&= \int \frac{1}{\tan^2 x + 2} \text{d} (\tan x) \\
&= \frac{1}{\sqrt{2}} \int \frac{1}{(\frac{\tan x}{\sqrt{2}})^2 + 1} \text{d} (\frac{\tan x}{\sqrt{2}}) \\
&= \frac{1}{\sqrt{2}} \arcsin (\frac{\tan x}{\sqrt{2}}) + C
\end{aligned}
$$

[例 8] 求 $\displaystyle\int \frac{1}{1 + x^4} \text{d} x$。

法一：因式分解

- 注意到 $1 + x^4 = (x^2 - \sqrt{2} x + 1)(x^2 + \sqrt{2} x + 1)$，通过待定系数法可以解出：

$$
\int \frac{1}{1 + x^4} \text{d} x = \int \frac{\frac{1}{2 \sqrt{2}} x + \frac{1}{2}}{x^2 - \sqrt{2} x + 1} \text{d} x - \int \frac{-\frac{1}{2 \sqrt{2}} x + \frac{1}{2}}{x^2 + \sqrt{2} x + 1} \text{d} x
$$

- 对第一项换元 $u = x - \dfrac{1}{\sqrt{2}}$ 可得：

$$
\begin{aligned}
\int \frac{\frac{1}{2 \sqrt{2}} x + \frac{1}{2}}{x^2 - \sqrt{2} x + 1} \text{d} x &= \int \frac{\frac{1}{2 \sqrt{2}} u + \frac{1}{4}}{u^2 + \frac{1}{2}} \text{d} u \\
&= \frac{1}{2 \sqrt{2}} \int \frac{u}{u^2 + \frac{1}{2}} \text{d} u + \frac{1}{4} \int \frac{1}{u^2 + \frac{1}{2}} \text{d} u \\
&= \frac{1}{4 \sqrt{2}} \int \frac{1}{u^2 + \frac{1}{2}} \text{d} (u^2) + \frac{1}{2 \sqrt{2}} \int \frac{1}{(\sqrt{2} u)^2 + 1} \text{d} (\sqrt{2} u) \\
&= \frac{1}{4 \sqrt{2}} \ln |u^2 + \frac{1}{2}| + \frac{1}{2 \sqrt{2}} \arctan (\sqrt{2} u) + C \\
&= \frac{1}{4 \sqrt{2}} \ln (x^2 - \sqrt{2} x + 1) + \frac{1}{2 \sqrt{2}} \arctan (\sqrt{2} x - 1) + C
\end{aligned}
$$

- 对第二项换元 $v = x + \dfrac{1}{\sqrt{2}}$，同理可得：

$$
\int \frac{-\frac{1}{2 \sqrt{2}} x + \frac{1}{2}}{x^2 + \sqrt{2} x + 1} \text{d} x = \frac{1}{4 \sqrt{2}} \ln (x^2 + \sqrt{2} x + 1) + \frac{1}{2 \sqrt{2}} \arctan (-\sqrt{2} x - 1) + C
$$

- 故所求即为：

$$
\int \frac{1}{1 + x^4} \text{d} x = \frac{1}{4 \sqrt{2}} \ln \frac{x^2 - \sqrt{2} x + 1}{x^2 + \sqrt{2} x + 1} + \frac{1}{2 \sqrt{2}} \arctan (\sqrt{2} x - 1) + \frac{1}{2 \sqrt{2}} \arctan (\sqrt{2} x + 1) + C
$$

法二：~~人类智慧~~回文构造

- 设 $F(x) = \displaystyle\int \frac{1}{1 + x^4} \text{d} x, G(x) = \displaystyle\int \frac{x^2}{1 + x^4} \text{d} x$。
- 首先计算 $F(x) + G(x)$：

$$
\begin{aligned}
F(x) + G(x) &= \int \frac{1 + x^2}{1 + x^4} \text{d} x \\
&= \int \frac{1 + \frac{1}{x^2}}{x^2 + \frac{1}{x^2}} \text{d} x \\
&= \int \frac{1}{u^2 + 2} \text{d} u &\quad (u = x - \frac{1}{x}) \\
&= \frac{1}{\sqrt{2}} \int \frac{1}{(\frac{u}{\sqrt{2}})^2 + 1} \text{d} (\frac{u}{\sqrt{2}}) \\
&= \frac{1}{\sqrt{2}} \arctan (\frac{u}{\sqrt{2}}) + C \\
&= \frac{1}{\sqrt{2}} \arctan (\frac{x - \frac{1}{x}}{\sqrt{2}}) + C
\end{aligned}
$$

- 接下来计算 $F(x) - G(x)$：

$$
\begin{aligned}
F(x) + G(x) &= \int \frac{1 - x^2}{1 + x^4} \text{d} x \\
&= \int \frac{1 - \frac{1}{x^2}}{x^2 + \frac{1}{x^2}} \text{d} x \\
&= \int \frac{1}{v^2 - 2} \text{d} v &\quad (v = x + \frac{1}{x}) \\
&= \frac{1}{\sqrt{2}} \int \frac{1}{(\frac{v}{\sqrt{2}})^2 - 1} \text{d} (\frac{v}{\sqrt{2}}) \\
&= \frac{1}{2 \sqrt{2}} \ln |\frac{\frac{v}{\sqrt{2}} - 1}{\frac{v}{\sqrt{2}} + 1}| + C \\
&= \frac{1}{2 \sqrt{2}} \ln |\frac{x^2 - \sqrt{2} x + 1}{x^2 + \sqrt{2} x + 1}| + C \\
&= \frac{1}{2 \sqrt{2}} \ln (\frac{x^2 - \sqrt{2} x + 1}{x^2 + \sqrt{2} x + 1}) + C
\end{aligned}
$$

- 故有：

$$
\begin{aligned}
F(x) &= \frac{1}{2} ((F(x) + G(x)) + (F(x) - G(x))) \\
&= \frac{1}{2 \sqrt{2}} \arctan (\frac{x - \frac{1}{x}}{\sqrt{2}}) + \frac{1}{4 \sqrt{2}} \ln (\frac{x^2 - \sqrt{2} x + 1}{x^2 + \sqrt{2} x + 1}) + C
\end{aligned}
$$

------

两种方法得出的结果（至少在形式上）并不一致，这是怎么回事呢？

- 令 $\alpha = \arctan (\sqrt{2} x - 1), \beta = \arctan (\sqrt{2} x + 1)$，则：

$$
\begin{aligned}
\tan (\alpha + \beta) &= \dfrac{(\sqrt{2} x - 1) + (\sqrt{2} x + 1)}{1 - (\sqrt{2} x - 1)(\sqrt{2} x + 1)} \\
&= \frac{\sqrt{2} x}{1 - x^2}
\end{aligned}
$$

- 注意到这刚好就是 $\dfrac{x - \frac{1}{x}}{\sqrt{2}}$ 的倒数的相反数，故 $\arctan (\dfrac{x - \frac{1}{x}}{\sqrt{2}}) = (\alpha + \beta) + k \pi$，两个结果之间只相差 $\dfrac{k \pi}{2 \sqrt{2}}$。
- **等一下，这个 $k$ 是常数吗？**

如果把两个函数的图像分别画出来，问题就出现了：

- 当 $x < 0$，法二的代表元比法一的大 $\dfrac{\pi}{4 \sqrt{2}}$。
- 当 $x = 0$，法二的代表元**没有定义**。
- 当 $x > 0$，法二的代表元比法一的小 $\dfrac{\pi}{4 \sqrt{2}}$。

问题就在于，$\dfrac{1}{1 + x^4}$ 在 $x = 0$ 处有定义，但法一的代表元在 $x = 0$ 处没有定义，导致两边“断开”了。

因此，需要对法二的结果作如下修正以使之连续：

$$
F(x) = C + \begin{cases}
\dfrac{1}{2 \sqrt{2}} \arctan (\dfrac{x - \frac{1}{x}}{\sqrt{2}}) + \dfrac{1}{4 \sqrt{2}} \ln (\dfrac{x^2 - \sqrt{2} x + 1}{x^2 + \sqrt{2} x + 1}) - \dfrac{\pi}{4 \sqrt{2}}, &\quad x < 0 \\
0, &\quad x = 0 \\
\dfrac{1}{2 \sqrt{2}} \arctan (\dfrac{x - \frac{1}{x}}{\sqrt{2}}) + \dfrac{1}{4 \sqrt{2}} \ln (\dfrac{x^2 - \sqrt{2} x + 1}{x^2 + \sqrt{2} x + 1}) + \dfrac{\pi}{4 \sqrt{2}}, &\quad x > 0
\end{cases}
$$

容易验证它确实是 $\dfrac{1}{1 + x^4}$ 的原函数。

- 可以通过计算 $\displaystyle\lim_{x \to 0^-} \frac{1}{2 \sqrt{2}} \arctan (\frac{x - \frac{1}{x}}{\sqrt{2}}), \lim_{x \to 0^+} \frac{1}{2 \sqrt{2}} \arctan (\frac{x - \frac{1}{x}}{\sqrt{2}})$ 之差的一半得到 $\dfrac{\pi}{4 \sqrt{2}}$ 这个数。

------

由于在 $\mathbb{R}$ 上对多项式因式分解总能得到一车一次式和一车有两个复根的二次式，法一事实上可以推广到任何有理函数的积分。

- _这个后面会细说。_

注意到法二能成立依赖于 $x^4 + 1$ 的系数关于 $x^2$ 的对称性，其可以推广到任何形如 $\dfrac{Ax^2 + Bx + C}{x^4 + Dx^2 + 1}$ 的分式的积分。

#### 第二换元法：正用复合函数求导

对于区间 $I$，已知函数 $f : I \to \mathbb{R}$，若 $F$ 为 $f$ 的原函数，$\varphi : J \to I$ 可导且严格单调（即 $\forall x \in J, \varphi'(x) \neq 0$），则其反函数存在，且有：

$$
\int f(x) \text{d} x = F(\varphi^{-1}(x)) + C
$$

- 若令 $t = \varphi^{-1}(x)$ 即 $x = \varphi(t)$，则 $f(x) \text{d} x = f(x) \varphi(t) \text{d} t$，故结果为 $F(\varphi(t)) = F(x)$。

[例 9] 求 $\displaystyle\int \sqrt{a^2 - x^2} \text{d} x \ (a > 0, |x| \leq a)$。

- _Motivation：诶，圆的方程不就是 $x^2 + y^2 = a^2$ 吗？这个 $y$ 又可以表示为三角函数，试试对 $x$ 三角换元？_
- 令 $x = a \sin t \ (t \in [-\dfrac{\pi}{2}, \dfrac{\pi}{2}])$，由于 $\sin$ 在 $[-\dfrac{\pi}{2}, \dfrac{\pi}{2}]$ 上可导且严格单调递增，有：

$$
\begin{aligned}
\int \sqrt{a^2 - x^2} \text{d} x &= \int \sqrt{a^2 - a^2 \sin^2 t} \text{d} (a \sin t) \\
&= a^2 \int \cos t \text{d} (\sin t) \\
&= a^2 \int \cos^2 t \text{d} t \\
&= a^2 \int \frac{\cos 2t + 1}{2} \text{d} t \\
&= a^2 (\frac{\sin 2t}{4} + \frac{t}{2} + C) \\
&= \frac{a^2}{2} \sin t \cos t + \frac{a^2}{2} t + C \\
&= \frac{a^2}{2} \cdot \frac{x}{a} \cdot \sqrt{1 - (\frac{x}{a})^2} + \frac{a^2}{2} \arcsin \frac{x}{a} + C \\
&= \frac{x}{2} \sqrt{a^2 - x^2} + \frac{a^2}{2} \arcsin \frac{x}{a} + C
\end{aligned}
$$

[例 10] 求 $\displaystyle\int \frac{1}{\sqrt{x^2 - a^2}} \text{d} x \ (|x| > a > 0)$。

- _Motivation：诶，$x^2 - y^2 = a^2$ 不是双曲线的方程吗？能不能仿照双曲线的参数方程来三角换元？_
- 令 $x = a \sec t \ (t \in (0, \dfrac{\pi}{2}) \cup (\dfrac{\pi}{2}, \pi))$，由于 $\sec$ 在 $(0, \dfrac{\pi}{2}), (\dfrac{\pi}{2}, \pi)$ 上可导且分别严格单调递增，**在两区间上分别**有：

$$
\begin{aligned}
\int \frac{1}{\sqrt{x^2 - a^2}} \text{d} x &= \int \frac{1}{\sqrt{\frac{a^2}{\cos^2 t} - a^2}} \text{d} (\frac{a}{\cos t}) \\
&= \int \frac{|\cos t|}{a \sin t} \cdot \frac{a \sin t}{\cos^2 t} \text{d} t \\
&= \int \frac{1}{|\cos t|} \text{d} t
\end{aligned}
$$

- 由于出现了绝对值，下面分类讨论。
- (1) 当 $t \in (0, \dfrac{\pi}{2})$，有：

$$
\begin{aligned}
\int \frac{1}{|\cos t|} \text{d} t &= \int \frac{1}{\cos t} \text{d} t \\
&= \int \frac{1}{\cos^2 t} \text{d} (\sin t) \\
&= \int \frac{1}{1 - u^2} \text{d} u &\quad (u = \sin t) \\
&= \frac{1}{2} (\int \frac{1}{1 - u} \text{d} u + \int \frac{1}{1 + u} \text{d} u) \\
&= \frac{1}{2} (-\ln |u - 1| + \ln |u + 1|) + C \\
&= \frac{1}{2} \ln \frac{1 + \sin t}{1 - \sin t} + C \\
&= \frac{1}{2} \ln \frac{(1 + \sin t)^2}{\cos^2 t} + C \\
&= \ln |\frac{1 + \sin t}{\cos t}| + C \\
&= \ln (\sec t + \tan t) + C \\
&= \ln (\frac{x}{a} + \sqrt{(\frac{x}{a})^2 - 1}) + C \\
&= \ln (x + \sqrt{x^2 - a^2}) + C \\
\end{aligned}
$$

- _这里最后一步去掉了 $-\ln a$ 的常数，因为这是一个从 $C$ 到 $C$ 的一一映射。_
- (2) 当 $t \in (\dfrac{\pi}{2}, \pi)$，有：

$$
\begin{aligned}
\int \frac{1}{|\cos t|} \text{d} t &= -\int \frac{1}{\cos t} \text{d} t \\
&= -\int \frac{1}{1 - u^2} \text{d} u &\quad (u = \sin t) \\
&= -\frac{1}{2} (-\ln |u - 1| + \ln |u + 1|) + C \\
&= -\frac{1}{2} \ln \frac{1 + \sin t}{1 - \sin t} + C \\
&= -\ln |\frac{1 + \sin t}{\cos t}| + C \\
&= -\ln (-\sec t - \tan t) + C \\
&= -\ln (-\frac{x}{a} - (-\sqrt{(\frac{x}{a})^2 - 1})) + C \\
&= -\ln (-x + \sqrt{x^2 - a^2}) + C \\
&= \ln (-x - \sqrt{x^2 - a^2}) + C
\end{aligned}
$$

- 综上，$\displaystyle\int \frac{1}{\sqrt{x^2 - a^2}} \text{d} x = \ln |x + \sqrt{x^2 - a^2}| + C$。

[例 11] 求 $\displaystyle\int \frac{1}{\sqrt{x^2 + a^2}} \text{d} x \ (a > 0)$。

- _Motivation：$y^2 - x^2 = a^2$ 跟例 10 反过来了！不妨反过来三角换元。_
- 令 $x = a \tan t \ (t \in (-\dfrac{\pi}{2}, \dfrac{\pi}{2}))$，由于 $\tan$ 在 $(-\dfrac{\pi}{2}, \dfrac{\pi}{2})$ 上可导且严格单调递增，有：

$$
\begin{aligned}
\displaystyle\int \frac{1}{\sqrt{x^2 + a^2}} \text{d} x &= \int \frac{1}{\sqrt{a^2 \tan^2 t + a^2}} \text{d} (a \tan t) \\
&= \int \frac{\cos t}{a} \cdot \frac{a}{\cos^2 t} \text{d} t \\
&= \int \frac{1}{\cos t} \text{d} t \\
&= \ln (\sec t + \tan t) + C &\quad (同例 10 可知) \\
&= \ln (\sqrt{1 + (\frac{x}{a})^2} + \frac{x}{a}) + C \\
&= \ln (x + \sqrt{x^2 + a^2}) + C
\end{aligned}
$$

[例 12] 求 $\displaystyle\int \frac{1}{\sqrt{x} + \sqrt[3]{x}} \text{d} x$。

- _Motivation：这个根式好烦啊，能不能变成整式？_
- 原积分中 $x \in (0, +\infty)$，令 $x = t^6 \ (t \in (0, +\infty))$，由于幂函数在 $(0, +\infty)$ 上可导且严格单调递增，有：

$$
\begin{aligned}
\int \frac{1}{\sqrt{x} + \sqrt[3]{x}} \text{d} x &= \int \frac{1}{t^3 + t^2} \text{d} (t^6) \\
&= 6 \int \frac{t^3}{t + 1} \text{d} t \\
&= 6 (\int (t^2 - t + 1) \text{d} t - \int \frac{1}{t + 1} \text{d} t) \\
&= 6 (\frac{1}{3} t^3 - \frac{1}{2} t^2 + t - \ln |t + 1| + C) \\
&= 2 \sqrt{x} - 3 \sqrt[3]{x} + 6 \sqrt[6]{x} - 6 \ln (\sqrt[6]{x} + 1) + C
\end{aligned}
$$

#### 分部积分法：逆用乘积函数求导

若 $u, v$ 可导且 $\displaystyle\int u'(x) v(x) \text{d} x$ 存在，则有：

$$
\int u(x) v'(x) \text{d} x = u(x) v(x) - \int u'(x) v(x) \text{d} x
$$

也可写作：

$$
\int u(x) \text{d} (v(x)) = u(x) v(x) - \int \text{d} (u(x)) v(x) 
$$

[例 13] 求 $\displaystyle\int x e^{-x} \text{d} x$。

$$
\begin{aligned}
\int x e^{-x} \text{d} x &= -\int x \text{d} (e^{-x}) \\
&= -(xe^{-x} - \int e^{-x} \text{d} x) \\
&= -(xe^{-x} - (-e^{-x} + C)) \\
&= -(x + 1) e^{-x} + C
\end{aligned}
$$

[例 14] 求 $\displaystyle\int x^2 \sin x \text{d} x$。

$$
\begin{aligned}
\int x^2 \sin x \text{d} x &= -\int x^2 \text{d} (\cos x) \\
&= -(x^2 \cos x - \int \cos x \text{d} (x^2)) \\
&= -x^2 \cos x + 2 \int x \cos x \text{d} x \\
&= -x^2 \cos x + 2 \int x \text{d} (\sin x) \\
&= -x^2 \cos x + 2(x \sin x - \int \sin x \text{d} x) \\
&= -x^2 \cos x + 2(x \sin x + \cos x + C) \\
&= -x^2 \cos x + 2x \sin x + 2 \cos x + C
\end{aligned}
$$

- 有趣的是，本题中我们第一次使用分部积分法将 $x^2 \sin x$ 的不定积分转化为 $x \cos x$ 的不定积分，第二次使用分部积分法将 $x \cos x$ 的不定积分转化为 $\sin x$ 的不定积分，实现了“降次”的效果。

[例 15] 求 $\displaystyle\int \ln x \text{d} x$。

$$
\begin{aligned}
\int \ln x \text{d} x &= x \ln x - \int x \text{d} (\ln x) \\
&= x \ln x - \int 1 \cdot \text{d} x \\
&= x \ln x - x + C
\end{aligned}
$$

[例 16] 求 $\displaystyle\int \sqrt{x^2 - 1} \text{d} x$。

$$
\begin{aligned}
\int \sqrt{x^2 - 1} \text{d} x &= x \sqrt{x^2 - 1} - \int x \text{d} (\sqrt{x^2 - 1}) \\
&= x \sqrt{x^2 - 1} - \int \frac{x^2}{\sqrt{x^2 - 1}} \text{d} x \\
&= x \sqrt{x^2 - 1} - (\int \sqrt{x^2 - 1} \text{d} x + \int \frac{1}{\sqrt{x^2 - 1}} \text{d} x) \\
&= x \sqrt{x^2 - 1} - \int \sqrt{x^2 - 1} \text{d} x - (\ln |x + \sqrt{x^2 - 1}| + C) &\quad (由例 10 可知)
\end{aligned}
$$

- _Motivation：虽然右边也出现了 $\displaystyle\int \sqrt{x^2 - 1} \text{d} x$，但没有抵消啊！能不能移到左边来构建方程？_
- 移项化简可得：

$$
\int \sqrt{x^2 - 1} \text{d} x = \frac{1}{2} x \sqrt{x^2 - 1} - \frac{1}{2} \ln |x + \sqrt{x^2 - 1}| + C
$$

[例 17] 求 $\displaystyle\int e^{ax} \cos (bx) \text{d} x \ (a, b \neq 0)$。

$$
\begin{aligned}
\int e^{ax} \cos (bx) \text{d} x &= \frac{1}{a} \int \cos (bx) \text{d} (e^{ax}) \\
&= \frac{1}{a} (e^{ax} \cos (bx) - \int e^{ax} \text{d} (\cos (bx))) \\
&= \frac{1}{a} (e^{ax} \cos (bx) + b \int e^{ax} \sin (bx) \text{d} x) \\
&= \frac{1}{a} (e^{ax} \cos (bx) + \frac{b}{a} \int \sin (bx) \text{d} (e^{ax})) \\
&= \frac{1}{a} (e^{ax} \cos (bx) + \frac{b}{a} (e^{ax} \sin (bx) - \int e^{ax} \text{d} (\sin (bx)))) \\
&= \frac{1}{a} (e^{ax} \cos (bx) + \frac{b}{a} (e^{ax} \sin (bx) - b \int e^{ax} \cos (bx) \text{d} x)) \\
\end{aligned}
$$

- 移项化简可得：

$$
\int e^{ax} \cos (bx) \text{d} x = \frac{e^{ax} (a \cos (bx) + b \sin (bx))}{a^2 + b^2} + C
$$

- 有趣的是，本题中 $e^{ax}, \cos (bx)$ 两个函数蕴含某种“积分下的形式不变性”——前者始终为 $\dfrac{1}{a^k} e^{ax}$，后者始终为 $\pm \dfrac{1}{b^k} \cos(bx), \pm \dfrac{1}{b^k} \sin(bx)$ 之一。这其实已经暗示我们可以通过反复施用分部积分法求解。

[例 18] 求 $I_n = \displaystyle\int \frac{1}{(x^2 + a^2)^n} \text{d} x \ (a \neq 0)$ 的递推式。

- 首先求解 $I_1$：

$$
\begin{aligned}
I_1 &= \int \frac{1}{x^2 + a^2} \text{d} x \\
&= \frac{1}{a} \int \frac{1}{(\frac{x}{a})^2 + 1} \text{d} (\frac{x}{a}) \\
&= \frac{1}{a} \arctan (\frac{x}{a}) + C
\end{aligned}
$$

- 接下来求解 $I_n \ (n > 1)$：

$$
\begin{aligned}
I_n &= \frac{x}{(x^2 + a^2)^n} - \int x \text{d} (\frac{1}{(x^2 + a^2)^n}) \\
&= \frac{x}{(x^2 + a^2)^n} - 2n \int \frac{x^2}{(x^2 + a^2)^{n + 1}} \text{d} x \\
&= \frac{x}{(x^2 + a^2)^n} - 2n (\int \frac{1}{(x^2 + a^2)^n} \text{d} x - \int \frac{a^2}{(x^2 + a^2)^{n + 1}} \text{d} x) \\
&= 2n a^2 I_{n + 1} - 2n I_n + \frac{x}{(x^2 + a^2)^n}
\end{aligned}
$$

- 注意到这个式子事实上在 $I_n$ 和 $I_{n + 1}$ 间建立了关联，不妨改口 $n \in \mathbb{N}_+$（显然不影响上述过程的正确性），得到如下递推式：

$$
I_{n + 1} = \frac{1}{2n a^2} ((2n + 1) I_n - \frac{x}{(x^2 + a^2)^n})
$$

### 有理函数的不定积分

有理函数即形如 $f(x) = \dfrac{P(x)}{Q(x)}$ 形式的函数，其中 $P(x), Q(x)$ 均为实系数多项式函数，且 $Q(x)$ 不恒为 $0$。

通过多项式的带余除法，我们可以将 $f(x)$ 改写为 $\dfrac{R(x)}{Q(x)} + S(x)$ 的形式，其中 $R(x), S(x)$ 均为实系数多项式函数，且 $\deg R < \deg Q$。而 $S(x)$ 的积分是好求的，下面只需考虑 $\dfrac{R(x)}{Q(x)}$ 的积分。

- 下面两个代数学定理都将不加证明地给出。

考虑先对 $Q(x)$ 做因式分解，我们有下面的定理。

#### 定理（实系数多项式唯一分解定理）

内容：

- 首一的实系数多项式函数 $Q(x)$ 总有不可约因式分解，形式如下：

$$
Q(x) = \prod_{i = 1}^r (x - a_i)^{k_i} \cdot \prod_{i = 1}^s (x^2 + p_i x + q_i)^{l_i}
$$

- 其中：

$$
\begin{cases}
\forall i \in [1, r] \cap \mathbb{N}, a_i \in \mathbb{R}, k_i \in \mathbb{N}_+ \\
\forall i \in [1, s] \cap \mathbb{N}, p_i, q_i \in \mathbb{R}, p_i^2 - 4q_i < 0, l_i \in \mathbb{N}_+
\end{cases}
$$

------

在此基础上，考虑将 $\dfrac{R(x)}{Q(x)}$ 写成较“简单”的分式之和，我们也有下面的定理。

#### 定理（有理函数的部分分式分解）

内容：

- 对于上面给出的 $Q(x)$ 和次数低于 $Q(x)$ 的实系数多项式函数 $R(x)$，$\dfrac{R(x)}{Q(x)}$ 有下面的分解式：

$$
\frac{R(x)}{Q(x)} = \sum_{i = 1}^r \sum_{j = 1}^{k_i} \frac{A_{i, j}}{(x - a_i)^j} + \sum_{i = 1}^s \sum_{j = 1}^{l_i} \frac{B_{i, j} x + C_{i, j}}{(x^2 + p_i x + q_i)^j}
$$

- 其中：

$$
\begin{cases}
\forall i \in [1, r] \cap \mathbb{N}, j \in [1, k_i] \cap \mathbb{N}, A_{i, j} \in \mathbb{R} \\
\forall i \in [1, s] \cap \mathbb{N}, j \in [1, l_i] \cap \mathbb{N}, B_{i, j}, C_{i, j} \in \mathbb{R}
\end{cases}
$$

-----

在此基础上，考虑其中每一项的计算，最后利用线性性加起来即得。

#### (1)：$\dfrac{1}{(x - a)^j}$

显然有下面的结果：

$$
\int \frac{1}{(x - a)^j} \text{d} x = \begin{cases}
\ln |x - a| + C, &\quad j = 1 \\
\dfrac{1}{1 - j} (x - a)^{1 - j} + C, &\quad j > 1
\end{cases}
$$

#### (2)：$\dfrac{Bx + C}{(x^2 + p x + q)^j}$

首先配方 $x^2 + px + q = u^2 + v^2$，其中 $u = x + \dfrac{p}{2}, v = \sqrt{q - \dfrac{p^2}{4}}$，则 $\dfrac{Bx + C}{(x^2 + p x + q)^j} = B \cdot \dfrac{u}{u^2 + v^2} + (C - \dfrac{Bp}{2}) \cdot \dfrac{1}{u^2 + v^2}$。

对于前者，考虑换元，有：

$$
\begin{aligned}
\int \frac{u}{(u^2 + v^2)^j} \text{d} u &= \frac{1}{2} \int \frac{1}{(u^2 + v^2)^j} \text{d} (u^2) \\
&= \frac{1}{2} \int \frac{1}{(u^2 + v^2)^j} \text{d} (u^2 + v^2) \\
&= C + \begin{cases}
\dfrac{1}{2} \ln |u^2 + v^2|, &\quad j = 1 \\
\dfrac{1}{2(1 - j)} (u^2 + v^2)^{1 - j}, &\quad j > 1
\end{cases} \\
&= C + \begin{cases}
\dfrac{1}{2} \ln (x^2 + px + q), &\quad j = 1 \\
\dfrac{1}{2(1 - j)} (x^2 + px + q)^{1 - j}, &\quad j > 1
\end{cases}
\end{aligned}
$$

对于后者，可以发现其正是例 18 中讨论的情况。

------

综上，我们成功地（至少在理论上 /youl）解决了任意有理函数的不定积分。

[例 19] 求 $\displaystyle\int \frac{x + 3}{x^3 + 2x^2 - x - 2} \text{d} x$。

对分母分解因式得到 $(x - 1)(x + 1)(x + 2)$，设有系数 $A, B, C \in \mathbb{R}$，使得：

$$
\frac{x + 3}{x^3 + 2x^2 - x - 2} = \frac{A}{x - 1} + \frac{B}{x + 1} + \frac{C}{x + 2} = \frac{(A + B + C) x^2 + (3A + B) x + (2A - 2B - C)}{x^3 + 2x^2 - x - 2}
$$

故可列出线性方程组：

$$
\begin{cases}
A + B + C = 0 \\
3A + B = 1 \\
2A - 2B - C = 3
\end{cases}
$$

解得：

$$
\begin{cases}
A = \dfrac{2}{3}  \\
B = -1 \\
C = \dfrac{1}{3}
\end{cases}
$$

故有：

$$
\begin{aligned}
\int \frac{x + 3}{x^3 + 2x^2 - x - 2} \text{d} x &= \frac{2}{3} \int \frac{1}{x - 1} \text{d} x - \int \frac{1}{x + 1} \text{d} x + \frac{1}{3} \int \frac{1}{x + 2} \text{d} x \\
&= \frac{2}{3} \ln |x - 1| - \ln |x + 1| + \frac{1}{3} \ln |x + 2| + C
\end{aligned}
$$

------

但硬解方程在分母次数更高时就棘手起来了。~~毕竟没人想手解五元甚至四元的线性方程组（~~

事实上，我们还有一个更便于手算的做法：

- (1) 对于 $A_{i, k_i}$，将等式两边同时乘上 $(x - a_i)^{k_i}$，然后令 $x = a_i$，可解得 $A_{i, k_i}$ 的值。移项后，可以将 $k_i$ 减 $1$。
- (2) 对于 $B_{i, l_i}, C_{i, l_i}$，将等式两边同时乘上 $(x^2 + p_i x + q_i)^{l_i}$，然后令 $x$ 为 $x^2 + p_i x + q_i = 0$ 的一个复根，可以根据等式两边的实部、虚部分别相等解得 $B_{i, l_i}, C_{i, l_i}$ 的值。移项后，可以将 $l_i$ 减 $1$。

[例 20] 求 $\displaystyle\int \frac{2x + 2}{(x - 1)(x^2 + 1)^2} \text{d} x$。

设有系数 $A, B, C, D, E \in \mathbb{R}$，使得：

$$
\frac{2x + 2}{(x - 1)(x^2 + 1)^2} = \frac{A}{x - 1} + \frac{Bx + C}{x^2 + 1} + \frac{Dx + E}{(x^2 + 1)^2}
$$

下面逐个求解分解式的系数：

- I. 将等式两边同时乘上 $(x^2 + 1)^2$，令 $x = i$，有 $Di + E = -2i$，得到 $D = -2, E = 0$。
- 移项整理可得 $\dfrac{2}{(x - 1)(x^2 + 1)} = \dfrac{A}{x - 1} + \dfrac{Bx + C}{x^2 + 1}$。
- II. 将等式两边同时乘上 $x^2 + 1$，令 $x = i$，有 $Bi + C = -i - 1$，得到 $B = C = -1$。
- 移项整理可得 $\dfrac{1}{x - 1} = \dfrac{A}{x - 1}$。
- III. 将等式两边同时乘上 $x - 1$，得到 $A = 1$。

故有：

$$
\begin{aligned}
\int \frac{2x + 2}{(x - 1)(x^2 + 1)^2} \text{d} x &= \int \frac{1}{x - 1} \text{d} x + \int \frac{-x - 1}{x^2 + 1} \text{d} x + \int \frac{-2x}{(x^2 + 1)^2} \text{d} x \\
&= \ln |x - 1| - \frac{1}{2} \ln (x^2 + 1) - \arctan x + \frac{1}{x^2 + 1} + C
\end{aligned}
$$

### 某些无理函数的不定积分

- 下面用 $R(x, y)$ 表示关于 $x, y$ 的有理函数。

#### 类型一：$\displaystyle\int R(\sin x, \cos x) \text{d} x$

为了将 $\sin, \cos$ 转化为**单变量**，考虑万能公式：

- 令 $t = \tan \dfrac{x}{2}$，这要求 $k \in \mathbb{Z}, x \in ((2k - 1) \pi, (2k + 1) \pi)$（**注意换元法的要求！**）。
- 则 $\sin x = \dfrac{2t}{1 + t^2}, \cos x = \dfrac{1 - t^2}{1 + t^2}, \text{d} x = \dfrac{2}{1 + t^2} \text{d} t$，它们都是关于 $t$ 的有理式。
- 故 $\displaystyle\int R(\sin x, \cos x) \text{d} x = \int R(\frac{2t}{1 + t^2}, \frac{1 - t^2}{1 + t^2}) \cdot \frac{2}{1 + t^2} \text{d} t$，可以发现被积函数正是一个关于 $t$ 的有理函数。

但这样做未必简洁，可能需要视情况改用其他换元方式。

[例 21] 求 $\displaystyle\int \frac{1}{\sin x + 2 \cos x + 3} \text{d} x$。

由于 $\sin x + 2 \cos x + 3 \geq 3 - \sqrt{5} > 0$，被积函数 $f(x) = \dfrac{1}{\sin x + 2 \cos x + 3}$ 在 $\mathbb{R}$ 上均有定义。

首先考察 $k \in \mathbb{Z}, x \in ((2k - 1) \pi, (2k + 1) \pi)$ 时的情况，此时令 $t = \tan \dfrac{x}{2}$，则有：

$$
\begin{aligned}
\int f(x) \text{d} x &= \int \frac{1}{\frac{2t}{1 + t^2} + 2 \cdot \frac{1 - t^2}{1 + t^2} + 3} \cdot \frac{2}{1 + t^2} \text{d} t \\
&= 2 \int \frac{1}{t^2 + 2t + 5} \text{d} t \\
&= 2 \int \frac{1}{(t + 1)^2 + 4} \text{d} t \\
&= \arctan \frac{t + 1}{2} + C \\
&= \arctan (\frac{1}{2} (1 + \tan \frac{x}{2})) + C
\end{aligned}
$$

由于 $f$ 在 $k \in \mathbb{Z}, x = (2k + 1) \pi$ 时有定义，考虑 $x$ 从两个方向趋近 $(2k + 1) \pi$ 时的极限：

$$
\begin{cases}
\displaystyle\lim_{x \to ((2k + 1) \pi)^-} \arctan (\frac{1}{2} (1 + \tan \frac{x}{2})) = \frac{\pi}{2} \\
\displaystyle\lim_{x \to ((2k + 1) \pi)^+} \arctan (\frac{1}{2} (1 + \tan \frac{x}{2})) = -\frac{\pi}{2}
\end{cases}
$$

进而可以发现，原函数在每个周期 $((2k - 1) \pi, (2k + 1) \pi)$ 内“上升”（_或者用下一讲的话说，补全端点定义后的闭区间上的定积分_）了 $\dfrac{\pi}{2} - (-\dfrac{\pi}{2}) = \pi$，然后回到原点。

断言下面给出的在 $\mathbb{R}$ 上连续的函数 $F$ 为 $f$ 的一个原函数：

$$
F(x) = \begin{cases}
\arctan (\dfrac{1}{2} (1 + \tan \dfrac{x}{2})) + k \pi, &\quad x \in ((2k - 1) \pi, (2k + 1) \pi), k \in \mathbb{Z} \\
\dfrac{(2k + 1) \pi}{2}, &\quad x = (2k + 1) \pi, k \in \mathbb{Z}
\end{cases}
$$

只需验证其在 $x_0 = (2k + 1) \pi, k \in \mathbb{Z}$ 处可导且 $F'(x_0) = f(x_0)$ 即可，而这通过导数极限定理不难证明。

综上，$\displaystyle\int f(x) \text{d} x = F(x) + C$。

------

可以发现，处理有关三角函数的不定积分问题时，我们有时会需要**分周期**处理。下面是一个与万能公式换元无关的例子。

[例 22] 求 $\displaystyle\int \sqrt{1 - \sin 2x} \text{d} x$。

首先化简被积函数：

$$
\begin{aligned}
\sqrt{1 - \sin 2x} &= \sqrt{(\sin x - \cos x)^2} \\
&= |\sin x - \cos x| \\
&= \begin{cases} \sin x - \cos x, &\quad x \in [2k \pi + \dfrac{\pi}{4}, 2k \pi + \dfrac{5 \pi}{4}), k \in \mathbb{Z} \\ \cos x - \sin x, &\quad x \in [2k \pi + \dfrac{5 \pi}{4}, 2k \pi + \dfrac{9 \pi}{4}), k \in \mathbb{Z} \end{cases}
\end{aligned}
$$

则：

- 若限定 $x \in [2k \pi + \dfrac{\pi}{4}, 2k \pi + \dfrac{5 \pi}{4}), k \in \mathbb{Z}$，则 $\displaystyle\int \sqrt{1 - \sin 2x} \text{d} x = -(\sin x + \cos x) + C$。
- 若限定 $x \in [2k \pi + \dfrac{5 \pi}{4}, 2k \pi + \dfrac{9 \pi}{4}), k \in \mathbb{Z}$，则 $\displaystyle\int \sqrt{1 - \sin 2x} \text{d} x = (\sin x + \cos x) + C$。

端点值相减即得：

- 在 $[2k \pi + \dfrac{\pi}{4}, 2k \pi + \dfrac{5 \pi}{4}]$ 内，原函数“上升”了 $\sqrt{2} - (-\sqrt{2}) = 2 \sqrt{2}$。
- 在 $[2k \pi + \dfrac{5 \pi}{4}, 2k \pi + \dfrac{9 \pi}{4}]$ 内，原函数“上升”了 $\sqrt{2} - (-\sqrt{2}) = 2 \sqrt{2}$。

故 $\displaystyle\int \sqrt{1 - \sin 2x} \text{d} x = F(x) + C$，其中 $F$ 的定义为：

$$
\begin{aligned}
F(x) = (-1)^{n + 1} (\sin x + \cos x) + 2 \sqrt{2} n, &\quad x \in [n \pi + \frac{\pi}{4}, n \pi + \frac{5 \pi}{4}]
\end{aligned}
$$

------

在处理这类问题时，有时可以构造关于 $\sin / \cos$ 的“对偶”积分式。

[例 23] 求 $\displaystyle\int \frac{\sin x}{2 \sin x + 3 \cos x} \text{d} x$。

令 $I = \displaystyle\int \frac{\sin x}{2 \sin x + 3 \cos x} \text{d} x, J = \int \frac{\cos x}{2 \sin x + 3 \cos x} \text{d} x$，则：

$$
\begin{cases}
2I + 3J = \displaystyle\int 1 \cdot \text{d} x = x + C \\
2J - 3I = \displaystyle\int \frac{(2 \sin x + 3 \cos x)'}{2 \sin x + 3 \cos x} \text{d} x = \int \text{d} (\frac{1}{2 \sin x + 3 \cos x}) = \ln |2 \sin x + 3 \cos x| + C
\end{cases}
$$

解得：

$$
\begin{cases}
I = \dfrac{1}{13} (2x - 3 \ln |2 \sin x + 3 \cos x|) + C \\
J = \dfrac{1}{13} (3x + 2 \ln |2 \sin x + 3 \cos x|) + C
\end{cases}
$$

#### 类型二：$\displaystyle\int R(x, \sqrt{ax^2 + bx + c}) \text{d} x$

考虑配方 $ax^2 + bx + c = a(x + \dfrac{b}{2a})^2 + (c - \dfrac{b^2}{4a})$，下面默认 $a \neq 0, c \neq \dfrac{b^2}{4a}$。

令 $u = \sqrt{|a|} (x + \dfrac{b}{2a}), v = \sqrt{|c - \dfrac{b^2}{4a}|}$，进而可以分类讨论：

$$
ax^2 + bx + c = \begin{cases}
u^2 + v^2, &\quad a > 0, c > \dfrac{b^2}{4a} \\
u^2 - v^2, &\quad a > 0, c < \dfrac{b^2}{4a} \\
v^2 - u^2, &\quad a < 0, c > \dfrac{b^2}{4a}
\end{cases}
$$

- 这里没有讨论 $a < 0, c < \dfrac{b^2}{4a}$ 的情况，因为此时 $ax^2 + bx + c < 0$，根式无意义。

因此可以这样换元：

$$
\int R(x, \sqrt{ax^2 + bx + c}) \text{d} x = \begin{cases}
\displaystyle\int R(u, \sqrt{u^2 + v^2}) \text{d} u \Rightarrow \text{let } u = v \tan t, &\quad a > 0, c > \dfrac{b^2}{4a} \\
\displaystyle\int R(u, \sqrt{u^2 - v^2}) \text{d} u \Rightarrow \text{let } u = v \sec t, &\quad a > 0, c < \dfrac{b^2}{4a} \\
\displaystyle\int R(u, \sqrt{v^2 - u^2}) \text{d} u \Rightarrow \text{let } u = v \sin t, &\quad a < 0, c > \dfrac{b^2}{4a}
\end{cases}
$$

故此类积分都能转化为三角函数的有理积分。

[例 24] 求 $\displaystyle\int \frac{\sqrt{x^2 + 2x + 2}}{x} \text{d} x$。

令 $s = \arctan (x + 1) \in (-\dfrac{\pi}{2}, \dfrac{\pi}{4}) \cup (\dfrac{\pi}{4}, \dfrac{\pi}{2})$，则有：

$$
\begin{aligned}
\int \frac{\sqrt{x^2 + 2x + 2}}{x} \text{d} x &= \int \frac{\sqrt{\tan^2 s + 1}}{\tan s - 1} \text{d} (\tan s - 1) \\
&= \int \frac{1}{\cos s (\sin s - \cos s) \cdot |\cos t|} \text{d} s \\
&= \int \frac{1}{\cos^2 s (\sin s - \cos s) } \text{d} s \\
&= \int \frac{1}{(\frac{1 - t^2}{1 + t^2})^2 (\frac{2t}{1 + t^2} - \frac{1 - t^2}{1 + t^2})} \cdot \frac{2}{1 + t^2} \text{d} t &\quad (t = \tan \frac{s}{2}) \\
&= 2 \int \frac{(t^2 + 1)^2}{(t - 1)^2 (t + 1)^2 (t - (\sqrt{2} - 1))(t - (-\sqrt{2} - 1))} \text{d} t \\
&= -\int \frac{1}{t - 1} \text{d} t + \frac{1}{2} \int \frac{1}{t + 1} \text{d} t + \frac{1}{2} \int \frac{1}{(t - 1)^2} \text{d} t - \int \frac{1}{(t + 1)^2} \text{d} t + \sqrt{2} \int \frac{1}{t - (\sqrt{2} - 1)} \text{d} t - \sqrt{2} \int \frac{1}{t - (-\sqrt{2} - 1)} \text{d} t \\
&= -\ln |t - 1| + \ln |t + 1| + \frac{-1}{t - 1} - \frac{-1}{t + 1} + \sqrt{2} \ln |t - (\sqrt{2} - 1)| - \sqrt{2} \ln |t - (-\sqrt{2} - 1)| + C \\
&= \ln |\frac{t + 1}{t - 1}| - \frac{2}{t^2 - 1} + \sqrt{2} \ln |\frac{t - \sqrt{2} + 1}{t + \sqrt{2} + 1}| + C
\end{aligned}
$$

~~这里就不带入 $t$ 关于 $x$ 的表达式了，因为这样的话答案就太丑了 /dk~~

#### 类型三：$\displaystyle\int R(x, \sqrt[n]{\frac{ax + b}{cx + d}}) \text{d} x \ (n \in \mathbb{N}_{> 1}, ad - bc \neq 0)$

令 $u = \sqrt[n]{\dfrac{ax + b}{cx + d}}$，则 $x = \dfrac{d u^n - b}{a - c u^k}$，故 $\text{d} x = \dfrac{k (ad - bc) u^{k - 1}}{(a - cu^k)^2} \text{d} u$，两者均为关于 $u$ 的有理式。

故 $\displaystyle\int R(x, \sqrt[n]{\frac{ax + b}{cx + d}}) \text{d} x = \int R(\dfrac{d u^n - b}{a - c u^k}, u) \cdot \frac{k (ad - bc) u^{k - 1}}{(a - cu^k)^2} \text{d} u$。

#### 类型四：$\displaystyle\int x^m (a + bx^n)^p \text{d} x \ (a, b \in \mathbb{R}, m, n, p \in \mathbb{Q})$

- _Motivation：想要去除无法化简的根号套根号的情况。_

令 $u = x^n$，则 $\text{d} x = \dfrac{1}{n} u^{\frac{1}{n} - 1} \text{d} u$，故有：

$$
\begin{aligned}
\int x^m (a + bx^n)^p \text{d} x &= \int u^{\frac{m}{n}} (a + bt)^p \cdot \frac{1}{n} u^{\frac{1}{n} - 1} \text{d} u \\
&= \frac{1}{n} \int u^{\frac{m + 1}{n} - 1} (a + bu)^p \text{d} u
\end{aligned}
$$

接下来分类讨论三种特殊情况：

- I. $p \in \mathbb{Z}$：此时只有 $u^{\frac{m + 1}{n} - 1}$ 可能不为整数，换元即可。
- II. $\dfrac{m + 1}{n} \in \mathbb{Z}$：此时只有 $p$ 可能不为整数，转化为前一种情况。
- III. $\dfrac{m + 1}{n} + p \in \mathbb{Z}$：将原积分转化为 $\dfrac{1}{n} \displaystyle\int u^{\frac{m + 1}{n} + p - 1} (\frac{a + bu}{u})^p \text{d} u$，此时只有 $p$ 可能不为整数，换元后转化为前一种情况。
- _注：Chebyshev 证明了除这三种情况外，$\displaystyle\int x^m (a + bx^n)^p \text{d} x$ 的原函数均为非初等函数。_

[例 25] 求 $\displaystyle\int \frac{\sqrt{x}}{\sqrt{1 - x^3}} \text{d} x$。

$$
\begin{aligned}
\int \frac{\sqrt{x}}{\sqrt{1 - x^3}} \text{d} x &= \frac{1}{3} \int \frac{1}{\sqrt{u (1 - u)}} \text{d} u &\quad (u = x^3) \\
&= \frac{1}{3} \int \frac{1}{\sqrt{1 - v^2}} \text{d} v &\quad (v = 2u - 1) \\
&= \frac{1}{3} (\arcsin v + C) \\
&= \frac{1}{3} \arcsin (2x^3 - 1) + C
\end{aligned}
$$
