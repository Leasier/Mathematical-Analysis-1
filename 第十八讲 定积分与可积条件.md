# 第十八讲 定积分与可积条件

### 引入：曲线下方面积的计算

考虑函数 $f(x) = x^2$，现在我们想要求出它在 $[0, 1]$ 上与坐标轴夹出的面积 $S$。

考虑将 $[0, 1]$ 切分为 $n$ 段，每段形如 $i \in \mathbb{N}_{< n}, [\dfrac{i}{n}, \dfrac{i + 1}{n}]$，则段内面积在 $(\dfrac{i^2}{n^3}, \dfrac{(i + 1)^2}{n^3})$ 之间。

故 $\dfrac{1}{3} (1 - \dfrac{1}{n}) (1 - \dfrac{1}{2n}) = \displaystyle\sum_{i = 0}^{n - 1} \frac{i^2}{n^3} < S < \sum_{i = 0}^{n - 1} \frac{(i + 1)^2}{n^3} = \dfrac{1}{3} (1 + \dfrac{1}{n}) (1 + \dfrac{1}{2n})$。

令 $n \to +\infty$，由夹挤原理即得 $S = \dfrac{1}{3}$。

### 定义：定积分

考察在 $[a, b]$ 上有定义的函数 $f$，取一组点 $a = x_0 < x_1 < \cdots < x_{n - 1} < x_n = b$ 构成一个**分割** $P$。

令 $\forall i \in [1, n] \cap \mathbb{N}, \Delta_i = x_i - x_{i - 1}$。

- _Motivation：从上面的“引入”部分可以看出，$\Delta_i$ 越小，则分割得“越细”。能不能给出一个量来描述这种“精细程度”？_

定义分割 $P$ 的模为 $|P| = \displaystyle\max_{i = 1}^n \Delta x_i$。

在每一个区间 $\forall i \in [1, n] \cap \mathbb{N}, [x_{i - 1}, x_i]$ 上任选一个标志点 $\xi_i$，构成标志点组 $\xi$。

对于**选定**的 $f, P, \xi$，定义 Riemann 和为 $\sigma(f, P, \xi) = \displaystyle\sum_{i = 1}^n f(\xi_i) \Delta x_i$。

我们称 $f$ 在 $[a, b]$ 上 Riemann 可积（简称可积），当且仅当：

$$
\exists I \in \mathbb{R}, \text{s.t. } \forall \epsilon > 0, \exists \delta > 0, \text{s.t. } \forall ||P|| < \delta, \forall \xi, |\sigma(f, P, \xi) - I| < \epsilon
$$

此时称 $I$ 为 $f$ 在 $[a, b]$ 上的 Riemann 积分（简称（定）积分），记作 $\displaystyle\int_a^b f(x) \text{d} x$，其中 $a, b$ 分别称为该积分的下、上限。

### 定积分的性质

#### 定积分的线性性

内容：若 $f, g$ 在 $[a, b]$ 上可积，则 $\forall f, g \in \mathbb{R}, \alpha f + \beta g$ 在 $[a, b]$ 上可积，且 $\displaystyle\int_a^b (\alpha f(x) + \beta g(x)) \text{d} x = \alpha \int_a^b f(x) \text{d} x + \beta \int_a^b g(x) \text{d} x$。

证明略。

#### 被积函数的有界性

内容：若 $f$ 在 $[a, b]$ 上可积，则 $f$ 在 $[a, b]$ 上有界。

证明：

- 考虑反证法，假设 $f$ 在 $[a, b]$ 上无界。
- $\forall I \in \mathbb{R}, \forall \delta > 0, \exists$ 长为 $\dfrac{\delta}{2}$ 的子区间 $[x_k, x_{k + 1}]$，$\text{s.t. } f$ 在 $[x_k, x_{k + 1}]$ 上无界。
- 接下来选取 $x_1, \cdots, x_{k - 1}, x_{k + 2}, \cdots, x_{n - 1}$，使得 $|P| = \dfrac{\delta}{2}$。
- 随后选取 $\xi_1, \cdots, \xi_k, \xi_{k + 2}, \cdots, \xi_n$，令 $s = \displaystyle\sum_{i \neq k} f(\xi_i) \Delta x_i$。
- 由无界可知 $\exists \xi_{k + 1} \in [x_k, x_{k + 1}], \text{s.t. } |f(\xi_{k + 1})| > \dfrac{2}{\delta} (|s - I| + 1)$。
- 令 $\epsilon_0 = 1$，则 $\sigma(f, P, \xi) = |s + \dfrac{2}{\delta} f(\xi_{k + 1}) - I| \geq ||\dfrac{2}{\delta} f(\xi_{k + 1})| - |s - I|| > 1 = \epsilon_0$。
- 故 $f$ 在 $[a, b]$ 上不可积，矛盾。故 $f$ 在 $[a, b]$ 上有界。

#### 定积分的可加性

内容：若 $f$ 在 $[a, b], [b, c]$ 上分别可积，则 $f$ 在 $[a, c]$ 上可积，且 $\displaystyle\int_a^c f(x) \text{d} x = \int_a^b f(x) \text{d} x + \int_b^c f(x) \text{d} x$。

证明：把 $[a, c]$ 的分割拆成 $[a, b], [b, c]$ 中的两块，再利用 $f$ 的有界性解决 $b$ 附近的问题即可，略。

------

方便起见，定义 $\displaystyle\int_a^a f(x) \text{d} x = 0$，并在 $a < b$ 时定义 $\displaystyle\int_b^a f(x) \text{d} x = -\int_a^b f(x) \text{d} x$，容易验证定积分的可加性仍然成立。

#### 定积分的单调性

内容：若 $f, g$ 在 $[a, b]$ 上可积，且 $\forall x \in [a, b], f(x) \leq g(x)$，则 $\displaystyle\int_a^b f(x) \text{d} x \leq \int_a^b g(x) \text{d} x$。

证明：

- 定义 $h(x) = g(x) - f(x)$，则 $h$ 在 $[a, b]$ 上可积，且 $\displaystyle\int_a^b h(x) \text{d} x = \int_a^b g(x) \text{d} x - \int_a^b f(x) \text{d} x$。
- 于是 $h$ 在 $[a, b]$ 上的 Riemann 和 $\sigma(h, P, \xi) = \displaystyle\sum_{i = 1}^n h(\xi_i) \Delta x_i \geq 0$，故 $\displaystyle\int_a^b h(x) \text{d} x = \lim_{|P| \to 0} \sigma(h, P, \xi) \geq 0$。
- 因此 $\displaystyle\int_a^b f(x) \text{d} x \leq \int_a^b g(x) \text{d} x$。

#### 积分中值定理 / 第一中值定理

内容：

- (1) 若 $f$ 在 $[a, b]$ 上可积，且 $f$ 在 $[a, b]$ 上有上、下界分别为 $M, m$，则 $m(b - a) \leq \displaystyle\int_a^b f(x) \text{d} x \leq M(b - a)$。
- (2) 在 (1) 的基础上，若 $f \in C[a, b]$，则 $\exists \xi \in [a, b], \text{s.t. } \displaystyle\int_a^b f(x) \text{d} x = f(\xi) (b - a)$。

证明：

- (1) $f$ 在 $[a, b]$ 上的 Riemann 和 $\sigma(f, P, \xi) = \displaystyle\sum_{i = 1}^n f(\xi_i) \Delta x_i \geq \sum_{i = 1}^n m \Delta x_i = m(b - a)$，故 $\displaystyle\int_a^b f(x) \text{d} x = \lim_{|P| \to 0} \sigma(f, P, \xi) \geq m(b - a)$。
- 同理有 $\displaystyle\int_a^b f(x) \text{d} x \leq M(b - a)$，遂得证。
- (2) 由 $f \in C[a, b]$，可取 $\exists x_1, x_2 \in [a, b], \text{s.t. } f(x_1) = \displaystyle\min_{x \in [a, b]} f(x), f(x_2) = \max_{x \in [a, b]} f(x)$。
- 令 $m = f(x_1), M = f(x_2)$，由 (1) 可知 $f(x_1) (b - a) \leq \displaystyle\int_a^b f(x) \text{d} x \leq f(x_2) (b - a)$。
- 故 $f(x_1) \leq \dfrac{1}{b - a} \displaystyle\int_a^b f(x) \text{d} x \leq f(x_2)$，进而由连续函数的介质性可知 $\exists \xi \in [a, b], \text{s.t. } f(\xi) = \dfrac{1}{b - a} \displaystyle\int_a^b f(x) \text{d} x \Leftrightarrow \int_a^b f(x) \text{d} x = f(\xi) (b - a)$。

### 可积条件

- _Motivation：如果可积，那么在分割的每一个区间中，取“最小的”和“最大的”应当差得“不太多”。_

#### Darboux 上下和

若 $f$ 在 $[a, b]$ 上有界，对于 $[a, b]$ 的一个分割 $P$，设其分割点为 $a = x_0 < x_1 < \cdots < x_{n - 1} < x_n = b$，令 $\forall i \in [1, n] \cap \mathbb{N}, m_i = \displaystyle\inf_{x \in [x_{i - 1}, x_i]} f(x), M_i = \sup_{x \in [x_{i - 1}, x_i]} f(x)$，然后定义：

- Darboux 下和（“全都取最低的标志点”）：$L(f, P) = \displaystyle\sum_{i = 1}^n m_i \Delta x_i = \inf_{\xi} \sigma(f, P, \xi)$。
- Darboux 上和（“全都取最高的标志点”）：$U(f, P) = \displaystyle\sum_{i = 1}^n M_i \Delta x_i = \sup_{\xi} \sigma(f, P, \xi)$。

方便起见，记 $\omega_i = M_i - m_i$。

#### 定理（Darboux 上下和的极限）

内容：若 $f$ 在 $[a, b]$ 上有界，则：

- (1) $\displaystyle\lim_{|P| \to 0} L(f, P) = \sup_P L(f, P) \equiv \underline{I} \in \mathbb{R}$，
- (2) $\displaystyle\lim_{|P| \to 0} U(f, P) = \inf_P U(f, P) \equiv \overline{I} \in \mathbb{R}$。
- (3) $\underline{I} \leq \overline{I}$。

证明：

- (1) 由 $f$ 在 $[a, b]$ 上有界可知其有上、下界 $M, m \in \mathbb{R}$。
- 由 $L(f, P) \geq m(b - a)$ 可知其有下确界 $\underline{I} = \displaystyle\sup_P L(f, P) \in \mathbb{R}$。
- 由下确界的性质可知 $\forall \epsilon > 0, \exists P_0, \text{s.t. } \underline{I} - \dfrac{1}{2} \epsilon < L(f, P_0) \leq \underline{I}$。
- _Motivation：欲证只要 $|P|$ 足够小，$L(f, P), L(f, P_0)$ 就足够接近。_
- _Motivation：但 $P$ 是任意的，如何跟 $P_0$ 联系起来？能不能构造一个“中介“？_
- 将 $P, P_0$ 的合在一起（即分割点排序后去重）得到 $\tilde{P}$，则易得 $\underline{I} - \dfrac{1}{2} \epsilon < L(f, P_0) \leq L(f, \tilde{P}) \leq \underline{I}$。
- _Motivation：由于 $P_0$ 是确定的，而我们可以钦定将 $P$ 分割得“想多密有多密”，考虑将 $P_0$ 中的分割点逐个插入 $P$ 中看看？_
- 设 $P$ 表示一组 $a = x_0 < x_1 < \cdots < x_{n - 1} < x_n = b$ 的分割，令 $\forall i \in [1, n] \cap \mathbb{N}, \Delta x_i = x_i - x_{i - 1}, m_i = \displaystyle\inf_{x \in [x_{i - 1}, x_i]} f(x), M_i = \sup_{x \in [x_{i - 1}, x_i]} f(x)$。
- 设在 $P_0$ 中且不在 $P$ 中的分割点有 $k$ 个，分别为 $a < y_1 < \cdots < y_k < b$，且 $\forall i \in [1, k] \cap \mathbb{N}, y_i \in (x_{p_i - 1}, x_{p_i})$。
- 首先插入 $y_1$ 得到 $P^{(1)}$，则显然 $L(f, P^{(1)}) - L(f, P) \geq 0$，且有：

$$
\begin{aligned}
L(f, P^{(1)}) - L(f, P) &= (\inf_{x \in [x_{p_1 - 1}, y_1]} f(x) \cdot (y_1 - x_{p_1 - 1}) + \inf_{x \in [y_1, x_{p_1}]} f(x) \cdot (x_{p_1} - y_1)) - m_{y_1} \Delta x_{y_1} \\
&\leq (M_{y_1} (y_1 - x_{p_1 - 1}) + M_{y_1} (x_{p_1} - y_1)) - m_{y_1} \Delta x_k \\
&= \omega_{y_1} \Delta x_{y_1} \\
&\leq \omega_{y_1} \delta \\
&\leq (M - m) \delta
\end{aligned}
$$

- 故有 $0 \leq L(f, P^{(1)}) - L(f, P) \leq (M - m) \delta$。
- 如此续行，依次令 $i \leftarrow 2, \cdots, k$，将 $y_i$ 插入 $P^{(i - 1)}$ 中得到 $P^{(i)}$，则 $0 \leq L(f, P^{(i)}) - L(f, P^{(i - 1)}) \leq (M - m) \delta$。
- 又由于 $\tilde{P} = P^{(k)}$，将上述 $k$ 个不等式相加即得 $0 \leq L(f, \tilde{P}) - L(f, P) \leq k(M - m) \delta$。
- 取 $\delta = \dfrac{\epsilon}{2k \max(M - m, 1)}$ 即得 $L(f, P) \geq L(f, \tilde{P}) - \dfrac{1}{2} \epsilon > I - \epsilon$。
- 故 $|L(f, P) - I| < \epsilon$，遂得证。
- (2) 同 (1) 理可证。
- (3) 由 $\forall P, L(f, P) \leq U(f, P)$ 可知 $\underline{I} = \displaystyle\lim_{|P| \to 0} L(f, P) \leq \lim_{|P| \to 0} U(f, P) = \overline{I}$。

------

记上面的 $\overline{I}, \underline{I}$ 分别为 $f$ 在 $[a, b]$ 上的（Darboux）上、下积分。

可以发现，当 $\underline{I} = \overline{I}$，$f$ 在 $[a, b]$ 上一定可积；事实上，反过来也是成立的。

#### 定理（有界函数的可积条件）

内容：若 $f$ 在 $[a, b]$ 上有界，则下列命题等价：

- (1) $\forall \epsilon > 0, \exists P, \text{s.t. } U(f, P) - L(f, P) < \epsilon$。
- (2) $\underline{I} = \overline{I}$。
- (3) $\displaystyle\lim_{|P| \to 0} (U(f, P) - L(f, P)) = 0$。
- (4) $f$ 在 $[a, b]$ 上 Riemann 可积。

证明：

- $(1) \Rightarrow (2)$：由 $L(f, P) \leq \underline{I} \leq \overline{I} \leq U(f, P)$ 可知 $0 \leq \overline{I} - \underline{I} \leq U(f, P) - L(f, P)$。
- 由 $\forall \epsilon > 0, \exists P, \text{s.t. } U(f, P) - L(f, P) < \epsilon$ 可知 $\forall \epsilon > 0, 0 \leq \overline{I} - \underline{I} < \epsilon$。
- 故 $\overline{I} - \underline{I} = 0$ 即 $\underline{I} = \overline{I}$。
- $(2) \Rightarrow (3)$：由上面的定理立即可得。
- $(3) \Rightarrow (4)$：由 $\displaystyle\lim_{|P| \to 0} (U(f, P) - L(f, P)) = 0$ 可知 $\displaystyle\lim_{|P| \to 0} L(f, P) = \lim_{|P| \to 0} U(f, P)$。
- 由 $\forall P, \forall \xi, L(f, P) \leq \sigma(f, P, \xi) \leq U(f, P)$ 可知 $\displaystyle\lim_{|P| \to 0} \sigma(f, P, \xi) = \displaystyle\lim_{|P| \to 0} L(f, P) = \lim_{|P| \to 0} U(f, P)$。
- $(4) \Rightarrow (1)$：设 $I = \displaystyle\int_a^b f(x) \text{d} x$，则 $\forall \epsilon > 0, \exists \delta > 0, \text{s.t. } \forall |P| < \delta, \forall \xi, |\sigma(f, P, \xi) - I| < \dfrac{1}{3} \epsilon$。
- 对于**给定**的 $P$，由 $U(f, P), L(f, P)$ 为 $\sigma(f, P, \xi)$ 的上、下确界可知 $I - \dfrac{1}{3} \epsilon \leq L(f, P) \leq U(f, P) \leq I + \dfrac{1}{3} \epsilon$。
- 故 $U(f, P) - L(f, P) \leq (I + \dfrac{1}{3} \epsilon) - (I - \dfrac{1}{3} \epsilon) = \dfrac{2}{3} \epsilon < \epsilon$，而满足 $|P| < \delta$ 的 $P$ 显然存在，遂得证。

------

这里 (1)(3) 的等价性乍一看并不显然，因为对**一元函数** $f$ 而言：

$$
\lim_{x \to a} f(x) = 0 \not\Leftrightarrow \forall \epsilon > 0, \exists x \in \check{U}(a), \text{s.t. } |f(x)| < \epsilon
$$

问题在于 $U(f, P)$ 和 $L(f, P)$ 随分割变密而具有某种“单调性”。

[例 1] Dirichlet 函数 $D(x) = \begin{cases} 1, &\quad x \in \mathbb{Q} \\ 0, &\text{otherwise} \end{cases}$，问 $D$ 在非退化闭区间 $[a, b]$ 上是否 Riemann 可积？

任意非退化闭区间上总能取出有理数和无理数，则 $\forall P, L(f, P) = 0, U(f, P) = b - a$，故 $\displaystyle\lim_{|P| \to 0} L(f, P) = 0 \neq b - a = \lim_{|P| \to 0} U(f, P)$，则 $D$ 在 $[a, b]$ 上非 Riemann 可积。

[例 2] Riemann 函数 $R(x) = \begin{cases} \dfrac{1}{q}, &\quad x = \dfrac{p}{q} 为既约分数, p \neq 0, q > 0 \\ 0, &\text{otherwise} \end{cases}$，问 $R$ 在非退化闭区间 $[a, b]$ 上是否 Riemann 可积？

任意非退化闭区间上总能取出无理数，则 $\forall P, L(f, P) = 0$。

注意到 $\dfrac{1}{q}$ “较大”的 $x$ 的数量是有限的，考虑设定阈值 $T$：

- 对于 $\dfrac{1}{q} \leq T$ 的 $x$，其总贡献不超过 $T (b - a)$。
- 对于 $\dfrac{1}{q} > T$ 的 $x$，其在 $[a, b]$ 中的数量不超过 $\displaystyle\sum_{1 \leq q < T} (\lfloor \frac{b - a}{q} \rfloor + 1)$，是有限的。设其数量为 $n$，则它们带来的贡献不超过 $n |P|$。

$\forall \epsilon > 0$，令 $T = \dfrac{\epsilon}{2(b - a)}, \delta = \dfrac{\epsilon}{2 \max(n, 1)}$，则 $\forall |P| < \delta, U(f, P) \leq T(b - a) + n|P| < \epsilon$。

故 $\displaystyle\lim_{|P| \to 0} U(f, P) = 0 = \lim_{|P| \to 0} L(f, P)$，则 $R$ 在 $[a, b]$ 上 Riemann 可积。

### 可积函数类

方便起见，记 $R[a, b]$ 表示在 $[a, b]$ 上 Riemann 可积的函数集合，$\Omega(f, P) = U(f, P) - L(f, P)$。

#### 性质 1

内容：若 $f \in R[a, b]$，则 $\forall [\tilde{a}, \tilde{b}] \subset [a, b], f \in R[\tilde{a}, \tilde{b}]$。

证明：

- 由 $f \in R[a, b]$ 可知 $\forall \epsilon > 0, \exists P, \text{s.t. } \Omega(f, P) < \epsilon$。
- 若 $P$ 中不包含 $\tilde{a}, \tilde{b}$ 之一，将其加入得到 $P'$，显然 $\Omega(f, P') \leq \Omega(f, P)$；否则令 $P' = P$。
- _Motivation：构成 $\Omega(f, P)$ 的和式逐项非负。_
- 接下来从 $P'$ 中删去 $[a, b] \backslash [\tilde{a}, \tilde{b}]$ 中的分割点得到 $P''$，显然 $\Omega(f, P'') \leq \Omega(f, P')$。
- 故 $\Omega(f, P'') < \epsilon$，则 $f \in R[\tilde{a}, \tilde{b}]$。

#### 性质 2

内容：若 $f \in R[a, b]$，则 $|f| \in R[a, b]$。

证明：

- _Motivation：$\displaystyle\sup_{x \in I} h(x) - \inf_{x \in I} h(x) = \sup_{x_1, x_2 \in I} (h(x_1) - h(x_2)) = \sup_{x_1, x_2 \in I} |h(x_1) - h(x_2)|$。_
- 考察 $\Omega(|f|, P)$：

$$
\begin{aligned}
\Omega(|f|, P) &= \sum_{i = 1}^n \omega_i(|f|) \\
&= \sum_{i = 1}^n \sup_{x_1, x_2 \in [x_{i - 1}, x_i]} (|f(x_1)| - |f(x_2)|) \\
&\leq \sum_{i = 1}^n \sup_{x_1, x_2 \in [x_{i - 1}, x_i]} |f(x_1) - f(x_2)| \\
&= \sum_{i = 1}^n \omega_i(f) \\
&= \Omega(f, P)
\end{aligned}
$$

- $\forall \epsilon > 0, \exists |P|, \text{s.t. } \Omega(f, P) < \epsilon$，则 $\Omega(|f|, P) \leq \Omega(f, P) < \epsilon$，故 $|f| \in R[a, b]$。

#### 性质 3

内容：若 $f, g \in R[a, b]$，则 $fg \in R[a, b]$。

证明：

- 考察 $\Omega(fg, P)$：

$$
\begin{aligned}
\Omega(fg, P) &= \sum_{i = 1}^n \omega_i(fg) \Delta x_i \\
&= \sum_{i = 1}^n \Delta x_i \sup_{x_1, x_2 \in [x_{i - 1}, x_i]} |f(x_1) g(x_1) - f(x_2) g(x_2)| \\
&= \sum_{i = 1}^n \Delta x_i \sup_{x_1, x_2 \in [x_{i - 1}, x_i]} |f(x_1) (g(x_1) - g(x_2)) + g(x_2) (f(x_1) - f(x_2))| \\
&\leq \sum_{i = 1}^n \Delta x_i \sup_{x_1, x_2 \in [x_{i - 1}, x_i]} (|f(x_1) (g(x_1) - g(x_2))| + |g(x_2) (f(x_1) - f(x_2))|) \\
&\leq \sum_{i = 1}^n \Delta x_i (\sup_{x_1, x_2 \in [x_{i - 1}, x_i]} |f(x_1) (g(x_1) - g(x_2))| + \sup_{x_1, x_2 \in [x_{i - 1}, x_i]} |g(x_2) (f(x_1) - f(x_2))|) \\
&\leq \sum_{i = 1}^n \Delta x_i (M_f \sup_{x_1, x_2 \in [x_{i - 1}, x_i]} |g(x_1) - g(x_2)| + M_g \sup_{x_1, x_2 \in [x_{i - 1}, x_i]} |f(x_1) - f(x_2)|) &\quad (M_f = \sup_{x \in [a, b]} |f(x)|, M_g = \sup_{x \in [a, b]} |g(x)|) \\
&\leq \sum_{i = 1}^n \Delta x_i (M_f \omega_i(g) + M_g \omega_i(f)) \\
&= M_f \Omega(g, P) + M_g \Omega(f, P)
\end{aligned}
$$

- _注意到这个跟乘积的极限存在的证明挺像的（_
- 故有：

$$
\forall \epsilon > 0, \begin{cases} \exists \delta_g > 0, \text{s.t. } \forall |P| < \delta_g, \Omega(g, P) < \dfrac{\epsilon}{2 \max(M_f, 1)} \\ \exists \delta_f > 0, \text{s.t. } \forall |P| < \delta_f, \Omega(f, P) < \dfrac{\epsilon}{2 \max(M_g, 1)} \end{cases} \Rightarrow \Omega(fg, P) < \epsilon
$$

- 故 $fg \in R[a, b]$。

#### 性质 4

内容：若 $f, g \in R[a, b]$，且 $\exists d > 0, \text{s.t. } \forall x \in [a, b], |g(x)| \geq d > 0$，则 $\dfrac{f}{g} \in R[a, b]$。

证明：

- 由于 $\dfrac{f}{g} = f \cdot \dfrac{1}{g}$，我们只需证明 $\dfrac{1}{g} \in R[a, b]$。
- 考察 $\Omega(\dfrac{1}{g}, P)$：

$$
\begin{aligned}
\Omega(\frac{1}{g}, P) &= \sum_{i = 1}^n \omega_i(\frac{1}{g}) \\
&= \sum_{i = 1}^n \sup_{x_1, x_2 \in [x_{i - 1}, x_i]} |\frac{1}{g(x_1)} - \frac{1}{g(x_2)}| \\
&= \sum_{i = 1}^n \sup_{x_1, x_2 \in [x_{i - 1}, x_i]} |\frac{g(x_2) - g(x_1)}{g(x_1) g(x_2)}| \\
&\leq \sum_{i = 1}^n \sup_{x_1, x_2 \in [x_{i - 1}, x_i]} |\frac{g(x_1) - g(x_2)}{d^2}| \\
&= \frac{1}{d^2} \sum_{i = 1}^n \sup_{x_1, x_2 \in [x_{i - 1}, x_i]} |g(x_1) - g(x_2)| \\
&= \frac{1}{d^2} \sum_{i = 1}^n \omega_i(g) \\
&= \frac{1}{d^2} \Omega(g, P)
\end{aligned}
$$

- $\forall \epsilon > 0, \exists |P|, \text{s.t. } \Omega(g, P) < d^2 \epsilon$，则 $\Omega(\dfrac{1}{g}, P) \leq \dfrac{1}{d^2} \Omega(g, P) < \epsilon$，故 $g \in R[a, b]$。

#### 性质 5

内容：若 $f$ 在 $[a, b]$ 上单调，则 $f \in R[a, b]$。

证明：

- 不妨设 $f$ 在 $[a, b]$ 上单调递增。
- $\forall P, \Omega(f, P) = \displaystyle\sum_{i = 1}^n (f(x_i) - f(x_{i - 1})) \Delta x_i \leq \sum_{i = 1}^n (f(x_i) - f(x_{i - 1})) |P| = (f(b) - f(a)) |P|$。
- $\forall \epsilon > 0$，令 $\delta = \dfrac{\epsilon}{f(b) - f(a) + 1}$，则 $\forall |P| < \delta, \Omega(f, P) < \epsilon$，故 $f \in R[a, b]$。

推广：

- 若 $f$ 为有界变差函数（可表示为**有限**个单调函数之和），则 $f \in R[a, b]$。

#### 性质 6

内容：若 $f \in C[a, b]$，则 $f \in R[a, b]$。

证明：

- 由于 $f$ 在 $[a, b]$ 上连续，可知其在 $[a, b]$ 上一致连续。
- $\forall \epsilon > 0, \exists \delta > 0, \text{s.t. } \forall x, y \in [a, b] \land |x - y| < \delta, |f(x) - f(y)| < \dfrac{\epsilon}{b - a}$。
- $\forall |P| < \delta, x_i - x_{i - 1} < \delta$，故 $U(f, P) - L(f, P) < (b - a) \cdot \dfrac{\epsilon}{b - a} = \epsilon$，则 $f \in R[a, b]$。

推广：

- (1) 若 $f$ 在 $[a, b]$ 上有界，且在除**有限**个间断点之外的点连续，则 $f \in R[a, b]$。
- (2) 若 $f \in R[a, b]$，且 $f, g$ 除**有限**个点之外处的取值都相等，则 $g \in R[a, b]$，且 $\displaystyle\int_a^b g(x) \text{d} x = \int_a^b f(x) \text{d} x$。

### 变上限积分

考虑 $f \in R[a, b]$，由可积函数的性质 1 可知 $\forall x \in [a, b], f \in R[a, x]$，记 $\Phi(x) = \displaystyle\int_a^x f(t) \text{d} t$。

#### 定理（变上限积分连续）

内容：$\Phi \in C[a, b]$。

证明：

- _Motivation：$\Phi$ 之差就是子区间上的定积分。_
- 由于 $f$ 可积，可得其有界为 $M > 0$。
- $\forall x_0 \in [a, b], |\Phi(x) - \Phi(x_0)| = |\displaystyle\int_{x_0}^x f(x) \text{d} x| \leq M |x - x_0|$。
- $\forall \epsilon > 0$，令 $\delta = \dfrac{\epsilon}{M}$，则 $\forall x \in \check{U}(x, \delta) \cap [a, b], |\Phi(x) - \Phi(x_0)| < M \delta = \epsilon$，则 $\Phi \in C[a, b]$。

#### 定理（变上限积分在被积函数连续处可导）

内容：$\forall x \in (a, b)$，若 $f$ 在 $x$ 处连续，则 $\Phi$ 在 $x$ 处可导，且 $\Phi'(x) = f(x)$。

证明：

- $\forall x_0 \in (a, b)$，有：

$$
\begin{aligned}
\forall x \in [a, b] \backslash \{x_0\}, \frac{\Phi(x) - \Phi(x_0)}{x - x_0} - f(x) &= \dfrac{1}{x - x_0} \int_{x_0}^x f(x) \text{d} x - f(x_0) \\
&= \frac{1}{x - x_0} \int_{x_0}^x (f(x) - f(x_0)) \text{d} x
\end{aligned}
$$

- 若 $f$ 在 $x_0$ 处连续，则 $\forall \epsilon > 0, \exists \delta > 0, \text{s.t. } \forall x \in \check{U}(x_0, \delta) \cap [a, b], |f(x) - f(x_0)| < \epsilon$，则：

$$
\begin{aligned}
\forall x \in \check{U}(x_0, \delta) \cap [a, b], |\frac{\Phi(x) - \Phi(x_0)}{x - x_0} - f(x)| &= \frac{1}{x - x_0} |\int_{x_0}^x (f(x) - f(x_0)) \text{d} x| \\
&\leq \frac{1}{x - x_0} \int_{x_0}^x |f(x) - f(x_0)| \text{d} x \\
&< \frac{1}{x - x_0} \int_{x_0}^x \epsilon \text{d} x \\
&= \frac{1}{x - x_0} \cdot (x - x_0) \epsilon \\
&= \epsilon
\end{aligned}
$$

- 故 $\displaystyle\lim_{x \to x_0} \frac{\Phi(x) - \Phi(x_0)}{x - x_0} = f(x)$，即 $\Phi$ 在 $x$ 处可导，且 $\Phi'(x) = f(x)$。

同理可知：

- $\forall x \in (a, b]$，若 $f$ 在 $x$ 处左连续，则 $\Phi$ 在 $x$ 处左侧可导，且 $\Phi'_-(x) = f(x)$。
- $\forall x \in [a, b)$，若 $f$ 在 $x$ 处右连续，则 $\Phi$ 在 $x$ 处右侧可导，且 $\Phi'_+(x) = f(x)$。
- _事实上，把“变上限”改为“变下限”不会对上面的证明造成任何影响。_

推论：

- 若 $u, v : [A, B] \to [a, b], f \in C[a, b]$，且 $u, v$ 在 $[A, B]$ 上可导，令 $w(x) = \displaystyle\int_{u(x)}^{v(x)} f(t) \text{d} t$，则 $w$ 在 $(A, B)$ 上可导，且 $\forall x \in (A, B), w'(x) = f(v(x)) v'(x) - f(u(x)) u'(x)$。

### 微积分基本定理

#### 定理（原函数的存在性）

内容：若 $f \in C[a, b]$，则 $f$ 在 $[a, b]$ 上必有原函数。

证明：$\Phi(x) = \displaystyle\int_a^x f(x)$ 即为 $f$ 在 $[a, b]$ 上的一个原函数。

------

但需要注意的是，“必有原函数”并不意味着“初等函数的原函数必可写出初等表达式”，如对数积分 $\text{Li}(x) = \displaystyle\int_2^x \dfrac{1}{\ln t} \text{d} t$。

#### 定理（Newton-Leibniz 公式）

内容：若 $f \in R[a, b]$ 且 $f$ 在 $[a, b]$ 上有原函数 $F$，则 $\displaystyle\int_a^b f(x) \text{d} x = F(b) - F(a)$。

- 有趣的是，尽管在前面的铺垫之下，这个定理看上去并没有“那么不平凡”，但它将“Riemann 和的极限”和“不定积分”这两个看似截然不同的东西联系到一起了。

证明：

- _Motivation：我想给出一种“很好算”的 Riemann 和。_
- $n$ 等分 $[a, b]$ 得到分割 $P_n$，则 $|P_n| = \dfrac{b - a}{n}$。
- 由 Lagrange 定理，可以如下选取标志点组 $\xi_n$：

$$
\forall i \in [1, n] \cap \mathbb{N}, \exists \xi_i \in [x_{i - 1}, x_i], \text{s.t. } F(x_i) - F(x_{i - 1}) = f(\xi_i) (x_i - x_{i - 1})
$$

- 则 $\sigma(f, P_n, \xi_n) = \displaystyle\sum_{i = 1}^n f(\xi_i) (x_i - x_{i - 1}) = \sum_{i = 1}^n (F(x_i) - F(x_{i - 1})) = F(b) - F(a)$，故 $\displaystyle\lim_{n \to +\infty} \sigma(f, P_n, \xi_n) = F(b) - F(a)$。
- 又由 $f \in R[a, b]$ 和 $\displaystyle\lim_{n \to +\infty} |P_n| = 0$，可知 $\displaystyle\int_a^b f(x) \text{d} x = \lim_{|P| \to 0} \sigma(f, P, \xi) = \lim_{n \to +\infty} \sigma(f, P_n, \xi_n) = F(b) - F(a)$。

#### 定义：Newton 可积

我们称 $f$ 在 $[a, b]$ 上 Newton 可积，若 $f$ 在 $[a, b]$ 上存在原函数。

#### 例子：两种可积不等价

##### Riemann 可积但非 Newton 可积

若 $f$ Newton 可积，则 $f$ 是某个 $F$ 的导函数，此时要求 $f$ 没有第一类间断点。从此出发，构造反例如下：

$$
f(x) = \begin{cases} 0, &\quad x \in [-1, 1] \backslash \{0\} \\ 1, &\quad x = 0 \end{cases}
$$

此时 $f$ 只在 $x = 0$ 一点与恒为 $0$ 的常值函数不同，故 $f \in R[-1, 1]$ 且 $\displaystyle\int_{-1}^1 f(x) \text{d} x = 0$。

但 $0$ 是 $f$ 的第一类间断点，故 $f$ 在 $[-1, 1]$ 上非 Newton 可积。

##### Newton 可积但非 Riemann 可积

若 $f$ Riemann 可积，则 $f$ 有界。从此出发，构造反例如下：

$$
\begin{aligned}
\alpha \in (0, 1), F(x) &= \begin{cases} x^{1 + \alpha} \sin \dfrac{1}{x}, &\quad x \in [-1, 1] \backslash \{0\} \\ 0, &\quad x = 0 \end{cases} \\
\Rightarrow F'(x) &= \begin{cases} (1 + \alpha) x^{\alpha} \sin \dfrac{1}{x} - x^{\alpha - 1} \cos \dfrac{1}{x}, &\quad x \in [-1, 1] \backslash \{0\} \\ 0, &\quad x = 0\end{cases}
\end{aligned}
$$

由于 $F'$ 在 $\check{U}(0)$ 上无界，可知 $F' \not \in R[-1, 1]$。

但 $F$ 为 $F'$ 的一个原函数，故 $F'$ 在 $[-1, 1]$ 上 Newton 可积。
